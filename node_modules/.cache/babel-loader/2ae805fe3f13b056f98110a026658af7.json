{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nexports.__esModule = true;\nexports.Database = exports.SERIALIZED_INTERNAL_PROPERTIES_KEY = void 0;\n\nvar md5_1 = __importDefault(require(\"md5\"));\n\nvar outvariant_1 = require(\"outvariant\");\n\nvar strict_event_emitter_1 = require(\"strict-event-emitter\");\n\nvar glossary_1 = require(\"../glossary\");\n\nexports.SERIALIZED_INTERNAL_PROPERTIES_KEY = 'SERIALIZED_INTERNAL_PROPERTIES';\nvar callOrder = 0;\n\nvar Database =\n/** @class */\nfunction () {\n  function Database(dictionary) {\n    this.events = new strict_event_emitter_1.StrictEventEmitter();\n    this.models = Object.keys(dictionary).reduce(function (acc, modelName) {\n      acc[modelName] = new Map();\n      return acc;\n    }, {});\n    callOrder++;\n    this.id = this.generateId();\n  }\n  /**\n   * Generates a unique MD5 hash based on the database\n   * module location and invocation order. Used to reproducibly\n   * identify a database instance among sibling instances.\n   */\n\n\n  Database.prototype.generateId = function () {\n    var stack = new Error().stack;\n    var callFrame = stack === null || stack === void 0 ? void 0 : stack.split('\\n')[4];\n    var salt = callOrder + \"-\" + (callFrame === null || callFrame === void 0 ? void 0 : callFrame.trim());\n    return md5_1[\"default\"](salt);\n  };\n\n  Database.prototype.serializeEntity = function (entity) {\n    var _a;\n\n    return __assign(__assign({}, entity), (_a = {}, _a[exports.SERIALIZED_INTERNAL_PROPERTIES_KEY] = {\n      entityType: entity[glossary_1.ENTITY_TYPE],\n      primaryKey: entity[glossary_1.PRIMARY_KEY]\n    }, _a));\n  };\n\n  Database.prototype.getModel = function (name) {\n    return this.models[name];\n  };\n\n  Database.prototype.create = function (modelName, entity, customPrimaryKey) {\n    outvariant_1.invariant(entity[glossary_1.ENTITY_TYPE], 'Failed to create a new \"%s\" record: provided entity has no type. %j', modelName, entity);\n    outvariant_1.invariant(entity[glossary_1.PRIMARY_KEY], 'Failed to create a new \"%s\" record: provided entity has no primary key. %j', modelName, entity);\n    var primaryKey = customPrimaryKey || entity[entity[glossary_1.PRIMARY_KEY]];\n    this.events.emit('create', this.id, [modelName, this.serializeEntity(entity), customPrimaryKey]);\n    return this.getModel(modelName).set(primaryKey, entity);\n  };\n\n  Database.prototype.update = function (modelName, prevEntity, nextEntity) {\n    var prevPrimaryKey = prevEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n    var nextPrimaryKey = nextEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n\n    if (nextPrimaryKey !== prevPrimaryKey) {\n      this[\"delete\"](modelName, prevPrimaryKey);\n    }\n\n    this.getModel(modelName).set(nextPrimaryKey, nextEntity); // this.create(modelName, nextEntity, nextPrimaryKey)\n\n    this.events.emit('update', this.id, [modelName, this.serializeEntity(prevEntity), this.serializeEntity(nextEntity)]);\n  };\n\n  Database.prototype[\"delete\"] = function (modelName, primaryKey) {\n    this.getModel(modelName)[\"delete\"](primaryKey);\n    this.events.emit('delete', this.id, [modelName, primaryKey]);\n  };\n\n  Database.prototype.has = function (modelName, primaryKey) {\n    return this.getModel(modelName).has(primaryKey);\n  };\n\n  Database.prototype.count = function (modelName) {\n    return this.getModel(modelName).size;\n  };\n\n  Database.prototype.listEntities = function (modelName) {\n    return Array.from(this.getModel(modelName).values());\n  };\n\n  return Database;\n}();\n\nexports.Database = Database;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__importDefault","mod","__esModule","exports","Database","SERIALIZED_INTERNAL_PROPERTIES_KEY","md5_1","require","outvariant_1","strict_event_emitter_1","glossary_1","callOrder","dictionary","events","StrictEventEmitter","models","keys","reduce","acc","modelName","Map","id","generateId","stack","Error","callFrame","split","salt","trim","serializeEntity","entity","_a","entityType","ENTITY_TYPE","primaryKey","PRIMARY_KEY","getModel","name","create","customPrimaryKey","invariant","emit","set","update","prevEntity","nextEntity","prevPrimaryKey","nextPrimaryKey","has","count","size","listEntities","Array","from","values"],"sources":["/Users/mcakmakali/Desktop/redux-example/node_modules/@mswjs/data/lib/db/Database.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nexports.__esModule = true;\nexports.Database = exports.SERIALIZED_INTERNAL_PROPERTIES_KEY = void 0;\nvar md5_1 = __importDefault(require(\"md5\"));\nvar outvariant_1 = require(\"outvariant\");\nvar strict_event_emitter_1 = require(\"strict-event-emitter\");\nvar glossary_1 = require(\"../glossary\");\nexports.SERIALIZED_INTERNAL_PROPERTIES_KEY = 'SERIALIZED_INTERNAL_PROPERTIES';\nvar callOrder = 0;\nvar Database = /** @class */ (function () {\n    function Database(dictionary) {\n        this.events = new strict_event_emitter_1.StrictEventEmitter();\n        this.models = Object.keys(dictionary).reduce(function (acc, modelName) {\n            acc[modelName] = new Map();\n            return acc;\n        }, {});\n        callOrder++;\n        this.id = this.generateId();\n    }\n    /**\n     * Generates a unique MD5 hash based on the database\n     * module location and invocation order. Used to reproducibly\n     * identify a database instance among sibling instances.\n     */\n    Database.prototype.generateId = function () {\n        var stack = new Error().stack;\n        var callFrame = stack === null || stack === void 0 ? void 0 : stack.split('\\n')[4];\n        var salt = callOrder + \"-\" + (callFrame === null || callFrame === void 0 ? void 0 : callFrame.trim());\n        return md5_1[\"default\"](salt);\n    };\n    Database.prototype.serializeEntity = function (entity) {\n        var _a;\n        return __assign(__assign({}, entity), (_a = {}, _a[exports.SERIALIZED_INTERNAL_PROPERTIES_KEY] = {\n            entityType: entity[glossary_1.ENTITY_TYPE],\n            primaryKey: entity[glossary_1.PRIMARY_KEY]\n        }, _a));\n    };\n    Database.prototype.getModel = function (name) {\n        return this.models[name];\n    };\n    Database.prototype.create = function (modelName, entity, customPrimaryKey) {\n        outvariant_1.invariant(entity[glossary_1.ENTITY_TYPE], 'Failed to create a new \"%s\" record: provided entity has no type. %j', modelName, entity);\n        outvariant_1.invariant(entity[glossary_1.PRIMARY_KEY], 'Failed to create a new \"%s\" record: provided entity has no primary key. %j', modelName, entity);\n        var primaryKey = customPrimaryKey || entity[entity[glossary_1.PRIMARY_KEY]];\n        this.events.emit('create', this.id, [\n            modelName,\n            this.serializeEntity(entity),\n            customPrimaryKey,\n        ]);\n        return this.getModel(modelName).set(primaryKey, entity);\n    };\n    Database.prototype.update = function (modelName, prevEntity, nextEntity) {\n        var prevPrimaryKey = prevEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n        var nextPrimaryKey = nextEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n        if (nextPrimaryKey !== prevPrimaryKey) {\n            this[\"delete\"](modelName, prevPrimaryKey);\n        }\n        this.getModel(modelName).set(nextPrimaryKey, nextEntity);\n        // this.create(modelName, nextEntity, nextPrimaryKey)\n        this.events.emit('update', this.id, [\n            modelName,\n            this.serializeEntity(prevEntity),\n            this.serializeEntity(nextEntity),\n        ]);\n    };\n    Database.prototype[\"delete\"] = function (modelName, primaryKey) {\n        this.getModel(modelName)[\"delete\"](primaryKey);\n        this.events.emit('delete', this.id, [modelName, primaryKey]);\n    };\n    Database.prototype.has = function (modelName, primaryKey) {\n        return this.getModel(modelName).has(primaryKey);\n    };\n    Database.prototype.count = function (modelName) {\n        return this.getModel(modelName).size;\n    };\n    Database.prototype.listEntities = function (modelName) {\n        return Array.from(this.getModel(modelName).values());\n    };\n    return Database;\n}());\nexports.Database = Database;\n"],"mappings":"AAAA;;AACA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;EAClDA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;IACpC,KAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;MACA,KAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;IACP;;IACD,OAAON,CAAP;EACH,CAPD;;EAQA,OAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,IAAIO,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;IAAE,WAAWA;EAAb,CAAvC;AACH,CAFD;;AAGAE,OAAO,CAACD,UAAR,GAAqB,IAArB;AACAC,OAAO,CAACC,QAAR,GAAmBD,OAAO,CAACE,kCAAR,GAA6C,KAAK,CAArE;;AACA,IAAIC,KAAK,GAAGN,eAAe,CAACO,OAAO,CAAC,KAAD,CAAR,CAA3B;;AACA,IAAIC,YAAY,GAAGD,OAAO,CAAC,YAAD,CAA1B;;AACA,IAAIE,sBAAsB,GAAGF,OAAO,CAAC,sBAAD,CAApC;;AACA,IAAIG,UAAU,GAAGH,OAAO,CAAC,aAAD,CAAxB;;AACAJ,OAAO,CAACE,kCAAR,GAA6C,gCAA7C;AACA,IAAIM,SAAS,GAAG,CAAhB;;AACA,IAAIP,QAAQ;AAAG;AAAe,YAAY;EACtC,SAASA,QAAT,CAAkBQ,UAAlB,EAA8B;IAC1B,KAAKC,MAAL,GAAc,IAAIJ,sBAAsB,CAACK,kBAA3B,EAAd;IACA,KAAKC,MAAL,GAAc5B,MAAM,CAAC6B,IAAP,CAAYJ,UAAZ,EAAwBK,MAAxB,CAA+B,UAAUC,GAAV,EAAeC,SAAf,EAA0B;MACnED,GAAG,CAACC,SAAD,CAAH,GAAiB,IAAIC,GAAJ,EAAjB;MACA,OAAOF,GAAP;IACH,CAHa,EAGX,EAHW,CAAd;IAIAP,SAAS;IACT,KAAKU,EAAL,GAAU,KAAKC,UAAL,EAAV;EACH;EACD;AACJ;AACA;AACA;AACA;;;EACIlB,QAAQ,CAACR,SAAT,CAAmB0B,UAAnB,GAAgC,YAAY;IACxC,IAAIC,KAAK,GAAG,IAAIC,KAAJ,GAAYD,KAAxB;IACA,IAAIE,SAAS,GAAGF,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAAjC,GAAqC,KAAK,CAA1C,GAA8CA,KAAK,CAACG,KAAN,CAAY,IAAZ,EAAkB,CAAlB,CAA9D;IACA,IAAIC,IAAI,GAAGhB,SAAS,GAAG,GAAZ,IAAmBc,SAAS,KAAK,IAAd,IAAsBA,SAAS,KAAK,KAAK,CAAzC,GAA6C,KAAK,CAAlD,GAAsDA,SAAS,CAACG,IAAV,EAAzE,CAAX;IACA,OAAOtB,KAAK,CAAC,SAAD,CAAL,CAAiBqB,IAAjB,CAAP;EACH,CALD;;EAMAvB,QAAQ,CAACR,SAAT,CAAmBiC,eAAnB,GAAqC,UAAUC,MAAV,EAAkB;IACnD,IAAIC,EAAJ;;IACA,OAAO7C,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK4C,MAAL,CAAT,GAAwBC,EAAE,GAAG,EAAL,EAASA,EAAE,CAAC5B,OAAO,CAACE,kCAAT,CAAF,GAAiD;MAC7F2B,UAAU,EAAEF,MAAM,CAACpB,UAAU,CAACuB,WAAZ,CAD2E;MAE7FC,UAAU,EAAEJ,MAAM,CAACpB,UAAU,CAACyB,WAAZ;IAF2E,CAA1D,EAGpCJ,EAHY,EAAf;EAIH,CAND;;EAOA3B,QAAQ,CAACR,SAAT,CAAmBwC,QAAnB,GAA8B,UAAUC,IAAV,EAAgB;IAC1C,OAAO,KAAKtB,MAAL,CAAYsB,IAAZ,CAAP;EACH,CAFD;;EAGAjC,QAAQ,CAACR,SAAT,CAAmB0C,MAAnB,GAA4B,UAAUnB,SAAV,EAAqBW,MAArB,EAA6BS,gBAA7B,EAA+C;IACvE/B,YAAY,CAACgC,SAAb,CAAuBV,MAAM,CAACpB,UAAU,CAACuB,WAAZ,CAA7B,EAAuD,qEAAvD,EAA8Hd,SAA9H,EAAyIW,MAAzI;IACAtB,YAAY,CAACgC,SAAb,CAAuBV,MAAM,CAACpB,UAAU,CAACyB,WAAZ,CAA7B,EAAuD,4EAAvD,EAAqIhB,SAArI,EAAgJW,MAAhJ;IACA,IAAII,UAAU,GAAGK,gBAAgB,IAAIT,MAAM,CAACA,MAAM,CAACpB,UAAU,CAACyB,WAAZ,CAAP,CAA3C;IACA,KAAKtB,MAAL,CAAY4B,IAAZ,CAAiB,QAAjB,EAA2B,KAAKpB,EAAhC,EAAoC,CAChCF,SADgC,EAEhC,KAAKU,eAAL,CAAqBC,MAArB,CAFgC,EAGhCS,gBAHgC,CAApC;IAKA,OAAO,KAAKH,QAAL,CAAcjB,SAAd,EAAyBuB,GAAzB,CAA6BR,UAA7B,EAAyCJ,MAAzC,CAAP;EACH,CAVD;;EAWA1B,QAAQ,CAACR,SAAT,CAAmB+C,MAAnB,GAA4B,UAAUxB,SAAV,EAAqByB,UAArB,EAAiCC,UAAjC,EAA6C;IACrE,IAAIC,cAAc,GAAGF,UAAU,CAACA,UAAU,CAAClC,UAAU,CAACyB,WAAZ,CAAX,CAA/B;IACA,IAAIY,cAAc,GAAGF,UAAU,CAACD,UAAU,CAAClC,UAAU,CAACyB,WAAZ,CAAX,CAA/B;;IACA,IAAIY,cAAc,KAAKD,cAAvB,EAAuC;MACnC,KAAK,QAAL,EAAe3B,SAAf,EAA0B2B,cAA1B;IACH;;IACD,KAAKV,QAAL,CAAcjB,SAAd,EAAyBuB,GAAzB,CAA6BK,cAA7B,EAA6CF,UAA7C,EANqE,CAOrE;;IACA,KAAKhC,MAAL,CAAY4B,IAAZ,CAAiB,QAAjB,EAA2B,KAAKpB,EAAhC,EAAoC,CAChCF,SADgC,EAEhC,KAAKU,eAAL,CAAqBe,UAArB,CAFgC,EAGhC,KAAKf,eAAL,CAAqBgB,UAArB,CAHgC,CAApC;EAKH,CAbD;;EAcAzC,QAAQ,CAACR,SAAT,CAAmB,QAAnB,IAA+B,UAAUuB,SAAV,EAAqBe,UAArB,EAAiC;IAC5D,KAAKE,QAAL,CAAcjB,SAAd,EAAyB,QAAzB,EAAmCe,UAAnC;IACA,KAAKrB,MAAL,CAAY4B,IAAZ,CAAiB,QAAjB,EAA2B,KAAKpB,EAAhC,EAAoC,CAACF,SAAD,EAAYe,UAAZ,CAApC;EACH,CAHD;;EAIA9B,QAAQ,CAACR,SAAT,CAAmBoD,GAAnB,GAAyB,UAAU7B,SAAV,EAAqBe,UAArB,EAAiC;IACtD,OAAO,KAAKE,QAAL,CAAcjB,SAAd,EAAyB6B,GAAzB,CAA6Bd,UAA7B,CAAP;EACH,CAFD;;EAGA9B,QAAQ,CAACR,SAAT,CAAmBqD,KAAnB,GAA2B,UAAU9B,SAAV,EAAqB;IAC5C,OAAO,KAAKiB,QAAL,CAAcjB,SAAd,EAAyB+B,IAAhC;EACH,CAFD;;EAGA9C,QAAQ,CAACR,SAAT,CAAmBuD,YAAnB,GAAkC,UAAUhC,SAAV,EAAqB;IACnD,OAAOiC,KAAK,CAACC,IAAN,CAAW,KAAKjB,QAAL,CAAcjB,SAAd,EAAyBmC,MAAzB,EAAX,CAAP;EACH,CAFD;;EAGA,OAAOlD,QAAP;AACH,CAtE6B,EAA9B;;AAuEAD,OAAO,CAACC,QAAR,GAAmBA,QAAnB"},"metadata":{},"sourceType":"script"}