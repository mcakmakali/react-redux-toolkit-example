{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : factory(global.Mock = global.Mock || {});\n})(this, function (exports) {\n  'use strict';\n\n  var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n  /**\n   * Check if we're required to add a port number.\n   *\n   * @see https://url.spec.whatwg.org/#default-port\n   * @param {Number|String} port Port number we need to check\n   * @param {String} protocol Protocol we need to check against.\n   * @returns {Boolean} Is it a default port for the given protocol\n   * @api private\n   */\n\n  var requiresPort = function required(port, protocol) {\n    protocol = protocol.split(':')[0];\n    port = +port;\n\n    if (!port) {\n      return false;\n    }\n\n    switch (protocol) {\n      case 'http':\n      case 'ws':\n        return port !== 80;\n\n      case 'https':\n      case 'wss':\n        return port !== 443;\n\n      case 'ftp':\n        return port !== 21;\n\n      case 'gopher':\n        return port !== 70;\n\n      case 'file':\n        return false;\n    }\n\n    return port !== 0;\n  };\n\n  var has = Object.prototype.hasOwnProperty;\n  var undef;\n  /**\n   * Decode a URI encoded string.\n   *\n   * @param {String} input The URI encoded string.\n   * @returns {String|Null} The decoded string.\n   * @api private\n   */\n\n  function decode(input) {\n    try {\n      return decodeURIComponent(input.replace(/\\+/g, ' '));\n    } catch (e) {\n      return null;\n    }\n  }\n  /**\n   * Attempts to encode a given input.\n   *\n   * @param {String} input The string that needs to be encoded.\n   * @returns {String|Null} The encoded string.\n   * @api private\n   */\n\n\n  function encode(input) {\n    try {\n      return encodeURIComponent(input);\n    } catch (e) {\n      return null;\n    }\n  }\n  /**\n   * Simple query string parser.\n   *\n   * @param {String} query The query string that needs to be parsed.\n   * @returns {Object}\n   * @api public\n   */\n\n\n  function querystring(query) {\n    var parser = /([^=?#&]+)=?([^&]*)/g,\n        result = {},\n        part;\n\n    while (part = parser.exec(query)) {\n      var key = decode(part[1]),\n          value = decode(part[2]); //\n      // Prevent overriding of existing properties. This ensures that build-in\n      // methods like `toString` or __proto__ are not overriden by malicious\n      // querystrings.\n      //\n      // In the case if failed decoding, we want to omit the key/value pairs\n      // from the result.\n      //\n\n      if (key === null || value === null || key in result) {\n        continue;\n      }\n\n      result[key] = value;\n    }\n\n    return result;\n  }\n  /**\n   * Transform a query string to an object.\n   *\n   * @param {Object} obj Object that should be transformed.\n   * @param {String} prefix Optional prefix.\n   * @returns {String}\n   * @api public\n   */\n\n\n  function querystringify(obj, prefix) {\n    prefix = prefix || '';\n    var pairs = [],\n        value,\n        key; //\n    // Optionally prefix with a '?' if needed\n    //\n\n    if ('string' !== typeof prefix) {\n      prefix = '?';\n    }\n\n    for (key in obj) {\n      if (has.call(obj, key)) {\n        value = obj[key]; //\n        // Edge cases where we actually want to encode the value to an empty\n        // string instead of the stringified value.\n        //\n\n        if (!value && (value === null || value === undef || isNaN(value))) {\n          value = '';\n        }\n\n        key = encode(key);\n        value = encode(value); //\n        // If we failed to encode the strings, we should bail out as we don't\n        // want to add invalid strings to the query.\n        //\n\n        if (key === null || value === null) {\n          continue;\n        }\n\n        pairs.push(key + '=' + value);\n      }\n    }\n\n    return pairs.length ? prefix + pairs.join('&') : '';\n  } //\n  // Expose the module.\n  //\n\n\n  var stringify = querystringify;\n  var parse = querystring;\n  var querystringify_1 = {\n    stringify: stringify,\n    parse: parse\n  };\n  var slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\n  var protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\\\/]+)?([\\S\\s]*)/i;\n  var whitespace = '[\\\\x09\\\\x0A\\\\x0B\\\\x0C\\\\x0D\\\\x20\\\\xA0\\\\u1680\\\\u180E\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200A\\\\u202F\\\\u205F\\\\u3000\\\\u2028\\\\u2029\\\\uFEFF]';\n  var left = new RegExp('^' + whitespace + '+');\n  /**\n   * Trim a given string.\n   *\n   * @param {String} str String to trim.\n   * @public\n   */\n\n  function trimLeft(str) {\n    return (str ? str : '').toString().replace(left, '');\n  }\n  /**\n   * These are the parse rules for the URL parser, it informs the parser\n   * about:\n   *\n   * 0. The char it Needs to parse, if it's a string it should be done using\n   *    indexOf, RegExp using exec and NaN means set as current value.\n   * 1. The property we should set when parsing this value.\n   * 2. Indication if it's backwards or forward parsing, when set as number it's\n   *    the value of extra chars that should be split off.\n   * 3. Inherit from location if non existing in the parser.\n   * 4. `toLowerCase` the resulting value.\n   */\n\n\n  var rules = [['#', 'hash'], // Extract from the back.\n  ['?', 'query'], // Extract from the back.\n  function sanitize(address, url) {\n    // Sanitize what is left of the address\n    return isSpecial(url.protocol) ? address.replace(/\\\\/g, '/') : address;\n  }, ['/', 'pathname'], // Extract from the back.\n  ['@', 'auth', 1], // Extract from the front.\n  [NaN, 'host', undefined, 1, 1], // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1], // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1] // Set left over.\n  ];\n  /**\n   * These properties should not be copied or inherited from. This is only needed\n   * for all non blob URL's as a blob URL does not include a hash, only the\n   * origin.\n   *\n   * @type {Object}\n   * @private\n   */\n\n  var ignore = {\n    hash: 1,\n    query: 1\n  };\n  /**\n   * The location object differs when your code is loaded through a normal page,\n   * Worker or through a worker using a blob. And with the blobble begins the\n   * trouble as the location object will contain the URL of the blob, not the\n   * location of the page where our code is loaded in. The actual origin is\n   * encoded in the `pathname` so we can thankfully generate a good \"default\"\n   * location from it so we can generate proper relative URL's again.\n   *\n   * @param {Object|String} loc Optional default location object.\n   * @returns {Object} lolcation object.\n   * @public\n   */\n\n  function lolcation(loc) {\n    var globalVar;\n\n    if (typeof window !== 'undefined') {\n      globalVar = window;\n    } else if (typeof commonjsGlobal !== 'undefined') {\n      globalVar = commonjsGlobal;\n    } else if (typeof self !== 'undefined') {\n      globalVar = self;\n    } else {\n      globalVar = {};\n    }\n\n    var location = globalVar.location || {};\n    loc = loc || location;\n    var finaldestination = {},\n        type = typeof loc,\n        key;\n\n    if ('blob:' === loc.protocol) {\n      finaldestination = new Url(unescape(loc.pathname), {});\n    } else if ('string' === type) {\n      finaldestination = new Url(loc, {});\n\n      for (key in ignore) {\n        delete finaldestination[key];\n      }\n    } else if ('object' === type) {\n      for (key in loc) {\n        if (key in ignore) {\n          continue;\n        }\n\n        finaldestination[key] = loc[key];\n      }\n\n      if (finaldestination.slashes === undefined) {\n        finaldestination.slashes = slashes.test(loc.href);\n      }\n    }\n\n    return finaldestination;\n  }\n  /**\n   * Check whether a protocol scheme is special.\n   *\n   * @param {String} The protocol scheme of the URL\n   * @return {Boolean} `true` if the protocol scheme is special, else `false`\n   * @private\n   */\n\n\n  function isSpecial(scheme) {\n    return scheme === 'file:' || scheme === 'ftp:' || scheme === 'http:' || scheme === 'https:' || scheme === 'ws:' || scheme === 'wss:';\n  }\n  /**\n   * @typedef ProtocolExtract\n   * @type Object\n   * @property {String} protocol Protocol matched in the URL, in lowercase.\n   * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n   * @property {String} rest Rest of the URL that is not part of the protocol.\n   */\n\n  /**\n   * Extract protocol information from a URL with/without double slash (\"//\").\n   *\n   * @param {String} address URL we want to extract from.\n   * @param {Object} location\n   * @return {ProtocolExtract} Extracted information.\n   * @private\n   */\n\n\n  function extractProtocol(address, location) {\n    address = trimLeft(address);\n    location = location || {};\n    var match = protocolre.exec(address);\n    var protocol = match[1] ? match[1].toLowerCase() : '';\n    var forwardSlashes = !!match[2];\n    var otherSlashes = !!match[3];\n    var slashesCount = 0;\n    var rest;\n\n    if (forwardSlashes) {\n      if (otherSlashes) {\n        rest = match[2] + match[3] + match[4];\n        slashesCount = match[2].length + match[3].length;\n      } else {\n        rest = match[2] + match[4];\n        slashesCount = match[2].length;\n      }\n    } else {\n      if (otherSlashes) {\n        rest = match[3] + match[4];\n        slashesCount = match[3].length;\n      } else {\n        rest = match[4];\n      }\n    }\n\n    if (protocol === 'file:') {\n      if (slashesCount >= 2) {\n        rest = rest.slice(2);\n      }\n    } else if (isSpecial(protocol)) {\n      rest = match[4];\n    } else if (protocol) {\n      if (forwardSlashes) {\n        rest = rest.slice(2);\n      }\n    } else if (slashesCount >= 2 && isSpecial(location.protocol)) {\n      rest = match[4];\n    }\n\n    return {\n      protocol: protocol,\n      slashes: forwardSlashes || isSpecial(protocol),\n      slashesCount: slashesCount,\n      rest: rest\n    };\n  }\n  /**\n   * Resolve a relative URL pathname against a base URL pathname.\n   *\n   * @param {String} relative Pathname of the relative URL.\n   * @param {String} base Pathname of the base URL.\n   * @return {String} Resolved pathname.\n   * @private\n   */\n\n\n  function resolve(relative, base) {\n    if (relative === '') {\n      return base;\n    }\n\n    var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/')),\n        i = path.length,\n        last = path[i - 1],\n        unshift = false,\n        up = 0;\n\n    while (i--) {\n      if (path[i] === '.') {\n        path.splice(i, 1);\n      } else if (path[i] === '..') {\n        path.splice(i, 1);\n        up++;\n      } else if (up) {\n        if (i === 0) {\n          unshift = true;\n        }\n\n        path.splice(i, 1);\n        up--;\n      }\n    }\n\n    if (unshift) {\n      path.unshift('');\n    }\n\n    if (last === '.' || last === '..') {\n      path.push('');\n    }\n\n    return path.join('/');\n  }\n  /**\n   * The actual URL instance. Instead of returning an object we've opted-in to\n   * create an actual constructor as it's much more memory efficient and\n   * faster and it pleases my OCD.\n   *\n   * It is worth noting that we should not use `URL` as class name to prevent\n   * clashes with the global URL instance that got introduced in browsers.\n   *\n   * @constructor\n   * @param {String} address URL we want to parse.\n   * @param {Object|String} [location] Location defaults for relative paths.\n   * @param {Boolean|Function} [parser] Parser for the query string.\n   * @private\n   */\n\n\n  function Url(address, location, parser) {\n    address = trimLeft(address);\n\n    if (!(this instanceof Url)) {\n      return new Url(address, location, parser);\n    }\n\n    var relative,\n        extracted,\n        parse,\n        instruction,\n        index,\n        key,\n        instructions = rules.slice(),\n        type = typeof location,\n        url = this,\n        i = 0; //\n    // The following if statements allows this module two have compatibility with\n    // 2 different API:\n    //\n    // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n    //    where the boolean indicates that the query string should also be parsed.\n    //\n    // 2. The `URL` interface of the browser which accepts a URL, object as\n    //    arguments. The supplied object will be used as default values / fall-back\n    //    for relative paths.\n    //\n\n    if ('object' !== type && 'string' !== type) {\n      parser = location;\n      location = null;\n    }\n\n    if (parser && 'function' !== typeof parser) {\n      parser = querystringify_1.parse;\n    }\n\n    location = lolcation(location); //\n    // Extract protocol information before running the instructions.\n    //\n\n    extracted = extractProtocol(address || '', location);\n    relative = !extracted.protocol && !extracted.slashes;\n    url.slashes = extracted.slashes || relative && location.slashes;\n    url.protocol = extracted.protocol || location.protocol || '';\n    address = extracted.rest; //\n    // When the authority component is absent the URL starts with a path\n    // component.\n    //\n\n    if (url.protocol === 'file:' || !extracted.slashes && (extracted.protocol || extracted.slashesCount < 2 || !isSpecial(url.protocol))) {\n      instructions[3] = [/(.*)/, 'pathname'];\n    }\n\n    for (; i < instructions.length; i++) {\n      instruction = instructions[i];\n\n      if (typeof instruction === 'function') {\n        address = instruction(address, url);\n        continue;\n      }\n\n      parse = instruction[0];\n      key = instruction[1];\n\n      if (parse !== parse) {\n        url[key] = address;\n      } else if ('string' === typeof parse) {\n        if (~(index = address.indexOf(parse))) {\n          if ('number' === typeof instruction[2]) {\n            url[key] = address.slice(0, index);\n            address = address.slice(index + instruction[2]);\n          } else {\n            url[key] = address.slice(index);\n            address = address.slice(0, index);\n          }\n        }\n      } else if (index = parse.exec(address)) {\n        url[key] = index[1];\n        address = address.slice(0, index.index);\n      }\n\n      url[key] = url[key] || (relative && instruction[3] ? location[key] || '' : ''); //\n      // Hostname, host and protocol should be lowercased so they can be used to\n      // create a proper `origin`.\n      //\n\n      if (instruction[4]) {\n        url[key] = url[key].toLowerCase();\n      }\n    } //\n    // Also parse the supplied query string in to an object. If we're supplied\n    // with a custom parser as function use that instead of the default build-in\n    // parser.\n    //\n\n\n    if (parser) {\n      url.query = parser(url.query);\n    } //\n    // If the URL is relative, resolve the pathname against the base URL.\n    //\n\n\n    if (relative && location.slashes && url.pathname.charAt(0) !== '/' && (url.pathname !== '' || location.pathname !== '')) {\n      url.pathname = resolve(url.pathname, location.pathname);\n    } //\n    // Default to a / for pathname if none exists. This normalizes the URL\n    // to always have a /\n    //\n\n\n    if (url.pathname.charAt(0) !== '/' && isSpecial(url.protocol)) {\n      url.pathname = '/' + url.pathname;\n    } //\n    // We should not add port numbers if they are already the default port number\n    // for a given protocol. As the host also contains the port number we're going\n    // override it with the hostname which contains no port number.\n    //\n\n\n    if (!requiresPort(url.port, url.protocol)) {\n      url.host = url.hostname;\n      url.port = '';\n    } //\n    // Parse down the `auth` for the username and password.\n    //\n\n\n    url.username = url.password = '';\n\n    if (url.auth) {\n      instruction = url.auth.split(':');\n      url.username = instruction[0] || '';\n      url.password = instruction[1] || '';\n    }\n\n    url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host ? url.protocol + '//' + url.host : 'null'; //\n    // The href is just the compiled result.\n    //\n\n    url.href = url.toString();\n  }\n  /**\n   * This is convenience method for changing properties in the URL instance to\n   * insure that they all propagate correctly.\n   *\n   * @param {String} part          Property we need to adjust.\n   * @param {Mixed} value          The newly assigned value.\n   * @param {Boolean|Function} fn  When setting the query, it will be the function\n   *                               used to parse the query.\n   *                               When setting the protocol, double slash will be\n   *                               removed from the final url if it is true.\n   * @returns {URL} URL instance for chaining.\n   * @public\n   */\n\n\n  function set(part, value, fn) {\n    var url = this;\n\n    switch (part) {\n      case 'query':\n        if ('string' === typeof value && value.length) {\n          value = (fn || querystringify_1.parse)(value);\n        }\n\n        url[part] = value;\n        break;\n\n      case 'port':\n        url[part] = value;\n\n        if (!requiresPort(value, url.protocol)) {\n          url.host = url.hostname;\n          url[part] = '';\n        } else if (value) {\n          url.host = url.hostname + ':' + value;\n        }\n\n        break;\n\n      case 'hostname':\n        url[part] = value;\n\n        if (url.port) {\n          value += ':' + url.port;\n        }\n\n        url.host = value;\n        break;\n\n      case 'host':\n        url[part] = value;\n\n        if (/:\\d+$/.test(value)) {\n          value = value.split(':');\n          url.port = value.pop();\n          url.hostname = value.join(':');\n        } else {\n          url.hostname = value;\n          url.port = '';\n        }\n\n        break;\n\n      case 'protocol':\n        url.protocol = value.toLowerCase();\n        url.slashes = !fn;\n        break;\n\n      case 'pathname':\n      case 'hash':\n        if (value) {\n          var char = part === 'pathname' ? '/' : '#';\n          url[part] = value.charAt(0) !== char ? char + value : value;\n        } else {\n          url[part] = value;\n        }\n\n        break;\n\n      default:\n        url[part] = value;\n    }\n\n    for (var i = 0; i < rules.length; i++) {\n      var ins = rules[i];\n\n      if (ins[4]) {\n        url[ins[1]] = url[ins[1]].toLowerCase();\n      }\n    }\n\n    url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host ? url.protocol + '//' + url.host : 'null';\n    url.href = url.toString();\n    return url;\n  }\n  /**\n   * Transform the properties back in to a valid and full URL string.\n   *\n   * @param {Function} stringify Optional query stringify function.\n   * @returns {String} Compiled version of the URL.\n   * @public\n   */\n\n\n  function toString(stringify) {\n    if (!stringify || 'function' !== typeof stringify) {\n      stringify = querystringify_1.stringify;\n    }\n\n    var query,\n        url = this,\n        protocol = url.protocol;\n\n    if (protocol && protocol.charAt(protocol.length - 1) !== ':') {\n      protocol += ':';\n    }\n\n    var result = protocol + (url.slashes || isSpecial(url.protocol) ? '//' : '');\n\n    if (url.username) {\n      result += url.username;\n\n      if (url.password) {\n        result += ':' + url.password;\n      }\n\n      result += '@';\n    }\n\n    result += url.host + url.pathname;\n    query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n\n    if (query) {\n      result += '?' !== query.charAt(0) ? '?' + query : query;\n    }\n\n    if (url.hash) {\n      result += url.hash;\n    }\n\n    return result;\n  }\n\n  Url.prototype = {\n    set: set,\n    toString: toString\n  }; //\n  // Expose the URL parser and some additional properties that might be useful for\n  // others or testing.\n  //\n\n  Url.extractProtocol = extractProtocol;\n  Url.location = lolcation;\n  Url.trimLeft = trimLeft;\n  Url.qs = querystringify_1;\n  var urlParse = Url;\n  /*\n   * This delay allows the thread to finish assigning its on* methods\n   * before invoking the delay callback. This is purely a timing hack.\n   * http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html\n   *\n   * @param {callback: function} the callback which will be invoked after the timeout\n   * @parma {context: object} the context in which to invoke the function\n   */\n\n  function delay(callback, context) {\n    setTimeout(function (timeoutContext) {\n      return callback.call(timeoutContext);\n    }, 4, context);\n  }\n\n  function log(method, message) {\n    /* eslint-disable no-console */\n    if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'test') {\n      console[method].call(null, message);\n    }\n    /* eslint-enable no-console */\n\n  }\n\n  function reject(array, callback) {\n    if (array === void 0) array = [];\n    var results = [];\n    array.forEach(function (itemInArray) {\n      if (!callback(itemInArray)) {\n        results.push(itemInArray);\n      }\n    });\n    return results;\n  }\n\n  function filter(array, callback) {\n    if (array === void 0) array = [];\n    var results = [];\n    array.forEach(function (itemInArray) {\n      if (callback(itemInArray)) {\n        results.push(itemInArray);\n      }\n    });\n    return results;\n  }\n  /*\n   * EventTarget is an interface implemented by objects that can\n   * receive events and may have listeners for them.\n   *\n   * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n   */\n\n\n  var EventTarget = function EventTarget() {\n    this.listeners = {};\n  };\n  /*\n   * Ties a listener function to an event type which can later be invoked via the\n   * dispatchEvent method.\n   *\n   * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n   * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n   * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n   */\n\n\n  EventTarget.prototype.addEventListener = function addEventListener(type, listener\n  /* , useCapture */\n  ) {\n    if (typeof listener === 'function') {\n      if (!Array.isArray(this.listeners[type])) {\n        this.listeners[type] = [];\n      } // Only add the same function once\n\n\n      if (filter(this.listeners[type], function (item) {\n        return item === listener;\n      }).length === 0) {\n        this.listeners[type].push(listener);\n      }\n    }\n  };\n  /*\n   * Removes the listener so it will no longer be invoked via the dispatchEvent method.\n   *\n   * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n   * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n   * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n   */\n\n\n  EventTarget.prototype.removeEventListener = function removeEventListener(type, removingListener\n  /* , useCapture */\n  ) {\n    var arrayOfListeners = this.listeners[type];\n    this.listeners[type] = reject(arrayOfListeners, function (listener) {\n      return listener === removingListener;\n    });\n  };\n  /*\n   * Invokes all listener functions that are listening to the given event.type property. Each\n   * listener will be passed the event as the first argument.\n   *\n   * @param {object} event - event object which will be passed to all listeners of the event.type property\n   */\n\n\n  EventTarget.prototype.dispatchEvent = function dispatchEvent(event) {\n    var this$1 = this;\n    var customArguments = [],\n        len = arguments.length - 1;\n\n    while (len-- > 0) customArguments[len] = arguments[len + 1];\n\n    var eventName = event.type;\n    var listeners = this.listeners[eventName];\n\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n\n    listeners.forEach(function (listener) {\n      if (customArguments.length > 0) {\n        listener.apply(this$1, customArguments);\n      } else {\n        listener.call(this$1, event);\n      }\n    });\n    return true;\n  };\n\n  function trimQueryPartFromURL(url) {\n    var queryIndex = url.indexOf('?');\n    return queryIndex >= 0 ? url.slice(0, queryIndex) : url;\n  }\n  /*\n   * The network bridge is a way for the mock websocket object to 'communicate' with\n   * all available servers. This is a singleton object so it is important that you\n   * clean up urlMap whenever you are finished.\n   */\n\n\n  var NetworkBridge = function NetworkBridge() {\n    this.urlMap = {};\n  };\n  /*\n   * Attaches a websocket object to the urlMap hash so that it can find the server\n   * it is connected to and the server in turn can find it.\n   *\n   * @param {object} websocket - websocket object to add to the urlMap hash\n   * @param {string} url\n   */\n\n\n  NetworkBridge.prototype.attachWebSocket = function attachWebSocket(websocket, url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n\n    if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) === -1) {\n      connectionLookup.websockets.push(websocket);\n      return connectionLookup.server;\n    }\n  };\n  /*\n   * Attaches a websocket to a room\n   */\n\n\n  NetworkBridge.prototype.addMembershipToRoom = function addMembershipToRoom(websocket, room) {\n    var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n\n    if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) !== -1) {\n      if (!connectionLookup.roomMemberships[room]) {\n        connectionLookup.roomMemberships[room] = [];\n      }\n\n      connectionLookup.roomMemberships[room].push(websocket);\n    }\n  };\n  /*\n   * Attaches a server object to the urlMap hash so that it can find a websockets\n   * which are connected to it and so that websockets can in turn can find it.\n   *\n   * @param {object} server - server object to add to the urlMap hash\n   * @param {string} url\n   */\n\n\n  NetworkBridge.prototype.attachServer = function attachServer(server, url) {\n    var serverUrl = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverUrl];\n\n    if (!connectionLookup) {\n      this.urlMap[serverUrl] = {\n        server: server,\n        websockets: [],\n        roomMemberships: {}\n      };\n      return server;\n    }\n  };\n  /*\n   * Finds the server which is 'running' on the given url.\n   *\n   * @param {string} url - the url to use to find which server is running on it\n   */\n\n\n  NetworkBridge.prototype.serverLookup = function serverLookup(url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n\n    if (connectionLookup) {\n      return connectionLookup.server;\n    }\n  };\n  /*\n   * Finds all websockets which is 'listening' on the given url.\n   *\n   * @param {string} url - the url to use to find all websockets which are associated with it\n   * @param {string} room - if a room is provided, will only return sockets in this room\n   * @param {class} broadcaster - socket that is broadcasting and is to be excluded from the lookup\n   */\n\n\n  NetworkBridge.prototype.websocketsLookup = function websocketsLookup(url, room, broadcaster) {\n    var serverURL = trimQueryPartFromURL(url);\n    var websockets;\n    var connectionLookup = this.urlMap[serverURL];\n    websockets = connectionLookup ? connectionLookup.websockets : [];\n\n    if (room) {\n      var members = connectionLookup.roomMemberships[room];\n      websockets = members || [];\n    }\n\n    return broadcaster ? websockets.filter(function (websocket) {\n      return websocket !== broadcaster;\n    }) : websockets;\n  };\n  /*\n   * Removes the entry associated with the url.\n   *\n   * @param {string} url\n   */\n\n\n  NetworkBridge.prototype.removeServer = function removeServer(url) {\n    delete this.urlMap[trimQueryPartFromURL(url)];\n  };\n  /*\n   * Removes the individual websocket from the map of associated websockets.\n   *\n   * @param {object} websocket - websocket object to remove from the url map\n   * @param {string} url\n   */\n\n\n  NetworkBridge.prototype.removeWebSocket = function removeWebSocket(websocket, url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n\n    if (connectionLookup) {\n      connectionLookup.websockets = reject(connectionLookup.websockets, function (socket) {\n        return socket === websocket;\n      });\n    }\n  };\n  /*\n   * Removes a websocket from a room\n   */\n\n\n  NetworkBridge.prototype.removeMembershipFromRoom = function removeMembershipFromRoom(websocket, room) {\n    var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n    var memberships = connectionLookup.roomMemberships[room];\n\n    if (connectionLookup && memberships !== null) {\n      connectionLookup.roomMemberships[room] = reject(memberships, function (socket) {\n        return socket === websocket;\n      });\n    }\n  };\n\n  var networkBridge = new NetworkBridge(); // Note: this is a singleton\n\n  /*\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n   */\n\n  var CLOSE_CODES = {\n    CLOSE_NORMAL: 1000,\n    CLOSE_GOING_AWAY: 1001,\n    CLOSE_PROTOCOL_ERROR: 1002,\n    CLOSE_UNSUPPORTED: 1003,\n    CLOSE_NO_STATUS: 1005,\n    CLOSE_ABNORMAL: 1006,\n    UNSUPPORTED_DATA: 1007,\n    POLICY_VIOLATION: 1008,\n    CLOSE_TOO_LARGE: 1009,\n    MISSING_EXTENSION: 1010,\n    INTERNAL_ERROR: 1011,\n    SERVICE_RESTART: 1012,\n    TRY_AGAIN_LATER: 1013,\n    TLS_HANDSHAKE: 1015\n  };\n  var ERROR_PREFIX = {\n    CONSTRUCTOR_ERROR: \"Failed to construct 'WebSocket':\",\n    CLOSE_ERROR: \"Failed to execute 'close' on 'WebSocket':\",\n    EVENT: {\n      CONSTRUCT: \"Failed to construct 'Event':\",\n      MESSAGE: \"Failed to construct 'MessageEvent':\",\n      CLOSE: \"Failed to construct 'CloseEvent':\"\n    }\n  };\n\n  var EventPrototype = function EventPrototype() {};\n\n  EventPrototype.prototype.stopPropagation = function stopPropagation() {};\n\n  EventPrototype.prototype.stopImmediatePropagation = function stopImmediatePropagation() {}; // if no arguments are passed then the type is set to \"undefined\" on\n  // chrome and safari.\n\n\n  EventPrototype.prototype.initEvent = function initEvent(type, bubbles, cancelable) {\n    if (type === void 0) type = 'undefined';\n    if (bubbles === void 0) bubbles = false;\n    if (cancelable === void 0) cancelable = false;\n    this.type = \"\" + type;\n    this.bubbles = Boolean(bubbles);\n    this.cancelable = Boolean(cancelable);\n  };\n\n  var Event = function (EventPrototype$$1) {\n    function Event(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT_ERROR + \" 1 argument required, but only 0 present.\");\n      }\n\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT_ERROR + \" parameter 2 ('eventInitDict') is not an object.\");\n      }\n\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.cancelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n    }\n\n    if (EventPrototype$$1) Event.__proto__ = EventPrototype$$1;\n    Event.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    Event.prototype.constructor = Event;\n    return Event;\n  }(EventPrototype);\n\n  var MessageEvent = function (EventPrototype$$1) {\n    function MessageEvent(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT.MESSAGE + \" 1 argument required, but only 0 present.\");\n      }\n\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT.MESSAGE + \" parameter 2 ('eventInitDict') is not an object\");\n      }\n\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      var data = eventInitConfig.data;\n      var origin = eventInitConfig.origin;\n      var lastEventId = eventInitConfig.lastEventId;\n      var ports = eventInitConfig.ports;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.canncelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n      this.origin = \"\" + origin;\n      this.ports = typeof ports === 'undefined' ? null : ports;\n      this.data = typeof data === 'undefined' ? null : data;\n      this.lastEventId = \"\" + (lastEventId || '');\n    }\n\n    if (EventPrototype$$1) MessageEvent.__proto__ = EventPrototype$$1;\n    MessageEvent.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    MessageEvent.prototype.constructor = MessageEvent;\n    return MessageEvent;\n  }(EventPrototype);\n\n  var CloseEvent = function (EventPrototype$$1) {\n    function CloseEvent(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT.CLOSE + \" 1 argument required, but only 0 present.\");\n      }\n\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT.CLOSE + \" parameter 2 ('eventInitDict') is not an object\");\n      }\n\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      var code = eventInitConfig.code;\n      var reason = eventInitConfig.reason;\n      var wasClean = eventInitConfig.wasClean;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.cancelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n      this.code = typeof code === 'number' ? parseInt(code, 10) : 0;\n      this.reason = \"\" + (reason || '');\n      this.wasClean = wasClean ? Boolean(wasClean) : false;\n    }\n\n    if (EventPrototype$$1) CloseEvent.__proto__ = EventPrototype$$1;\n    CloseEvent.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    CloseEvent.prototype.constructor = CloseEvent;\n    return CloseEvent;\n  }(EventPrototype);\n  /*\n   * Creates an Event object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config you will need to pass type and optionally target\n   */\n\n\n  function createEvent(config) {\n    var type = config.type;\n    var target = config.target;\n    var eventObject = new Event(type);\n\n    if (target) {\n      eventObject.target = target;\n      eventObject.srcElement = target;\n      eventObject.currentTarget = target;\n    }\n\n    return eventObject;\n  }\n  /*\n   * Creates a MessageEvent object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config: type, origin, data and optionally target\n   */\n\n\n  function createMessageEvent(config) {\n    var type = config.type;\n    var origin = config.origin;\n    var data = config.data;\n    var target = config.target;\n    var messageEvent = new MessageEvent(type, {\n      data: data,\n      origin: origin\n    });\n\n    if (target) {\n      messageEvent.target = target;\n      messageEvent.srcElement = target;\n      messageEvent.currentTarget = target;\n    }\n\n    return messageEvent;\n  }\n  /*\n   * Creates a CloseEvent object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config: type and optionally target, code, and reason\n   */\n\n\n  function createCloseEvent(config) {\n    var code = config.code;\n    var reason = config.reason;\n    var type = config.type;\n    var target = config.target;\n    var wasClean = config.wasClean;\n\n    if (!wasClean) {\n      wasClean = code === CLOSE_CODES.CLOSE_NORMAL || code === CLOSE_CODES.CLOSE_NO_STATUS;\n    }\n\n    var closeEvent = new CloseEvent(type, {\n      code: code,\n      reason: reason,\n      wasClean: wasClean\n    });\n\n    if (target) {\n      closeEvent.target = target;\n      closeEvent.srcElement = target;\n      closeEvent.currentTarget = target;\n    }\n\n    return closeEvent;\n  }\n\n  function closeWebSocketConnection(context, code, reason) {\n    context.readyState = WebSocket$1.CLOSING;\n    var server = networkBridge.serverLookup(context.url);\n    var closeEvent = createCloseEvent({\n      type: 'close',\n      target: context.target,\n      code: code,\n      reason: reason\n    });\n    var serverCloseEvent = createCloseEvent({\n      type: 'server::close',\n      target: context,\n      code: code,\n      reason: reason\n    });\n    delay(function () {\n      networkBridge.removeWebSocket(context, context.url);\n      context.readyState = WebSocket$1.CLOSED;\n      context.dispatchEvent(closeEvent);\n      context.dispatchEvent(serverCloseEvent);\n\n      if (server) {\n        server.dispatchEvent(closeEvent, server);\n      }\n    }, context);\n  }\n\n  function failWebSocketConnection(context, code, reason) {\n    context.readyState = WebSocket$1.CLOSING;\n    var server = networkBridge.serverLookup(context.url);\n    var closeEvent = createCloseEvent({\n      type: 'close',\n      target: context.target,\n      code: code,\n      reason: reason,\n      wasClean: false\n    });\n    var serverCloseEvent = createCloseEvent({\n      type: 'server::close',\n      target: context,\n      code: code,\n      reason: reason,\n      wasClean: false\n    });\n    var errorEvent = createEvent({\n      type: 'error',\n      target: context.target\n    });\n    delay(function () {\n      networkBridge.removeWebSocket(context, context.url);\n      context.readyState = WebSocket$1.CLOSED;\n      context.dispatchEvent(errorEvent);\n      context.dispatchEvent(closeEvent);\n      context.dispatchEvent(serverCloseEvent);\n\n      if (server) {\n        server.dispatchEvent(closeEvent, server);\n      }\n    }, context);\n  }\n\n  function normalizeSendData(data) {\n    if (Object.prototype.toString.call(data) !== '[object Blob]' && !(data instanceof ArrayBuffer)) {\n      data = String(data);\n    }\n\n    return data;\n  }\n\n  var proxies = new WeakMap();\n\n  function proxyFactory(target) {\n    if (proxies.has(target)) {\n      return proxies.get(target);\n    }\n\n    var proxy = new Proxy(target, {\n      get: function get(obj, prop) {\n        if (prop === 'close') {\n          return function close(options) {\n            if (options === void 0) options = {};\n            var code = options.code || CLOSE_CODES.CLOSE_NORMAL;\n            var reason = options.reason || '';\n            closeWebSocketConnection(proxy, code, reason);\n          };\n        }\n\n        if (prop === 'send') {\n          return function send(data) {\n            data = normalizeSendData(data);\n            target.dispatchEvent(createMessageEvent({\n              type: 'message',\n              data: data,\n              origin: this.url,\n              target: target\n            }));\n          };\n        }\n\n        if (prop === 'on') {\n          return function onWrapper(type, cb) {\n            target.addEventListener(\"server::\" + type, cb);\n          };\n        }\n\n        if (prop === 'target') {\n          return target;\n        }\n\n        return obj[prop];\n      }\n    });\n    proxies.set(target, proxy);\n    return proxy;\n  }\n\n  function lengthInUtf8Bytes(str) {\n    // Matches only the 10.. bytes that are non-initial characters in a multi-byte sequence.\n    var m = encodeURIComponent(str).match(/%[89ABab]/g);\n    return str.length + (m ? m.length : 0);\n  }\n\n  function urlVerification(url) {\n    var urlRecord = new urlParse(url);\n    var pathname = urlRecord.pathname;\n    var protocol = urlRecord.protocol;\n    var hash = urlRecord.hash;\n\n    if (!url) {\n      throw new TypeError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" 1 argument required, but only 0 present.\");\n    }\n\n    if (!pathname) {\n      urlRecord.pathname = '/';\n    }\n\n    if (protocol === '') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL '\" + urlRecord.toString() + \"' is invalid.\");\n    }\n\n    if (protocol !== 'ws:' && protocol !== 'wss:') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL's scheme must be either 'ws' or 'wss'. '\" + protocol + \"' is not allowed.\");\n    }\n\n    if (hash !== '') {\n      /* eslint-disable max-len */\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL contains a fragment identifier ('\" + hash + \"'). Fragment identifiers are not allowed in WebSocket URLs.\");\n      /* eslint-enable max-len */\n    }\n\n    return urlRecord.toString();\n  }\n\n  function protocolVerification(protocols) {\n    if (protocols === void 0) protocols = [];\n\n    if (!Array.isArray(protocols) && typeof protocols !== 'string') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The subprotocol '\" + protocols.toString() + \"' is invalid.\");\n    }\n\n    if (typeof protocols === 'string') {\n      protocols = [protocols];\n    }\n\n    var uniq = protocols.map(function (p) {\n      return {\n        count: 1,\n        protocol: p\n      };\n    }).reduce(function (a, b) {\n      a[b.protocol] = (a[b.protocol] || 0) + b.count;\n      return a;\n    }, {});\n    var duplicates = Object.keys(uniq).filter(function (a) {\n      return uniq[a] > 1;\n    });\n\n    if (duplicates.length > 0) {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The subprotocol '\" + duplicates[0] + \"' is duplicated.\");\n    }\n\n    return protocols;\n  }\n  /*\n   * The main websocket class which is designed to mimick the native WebSocket class as close\n   * as possible.\n   *\n   * https://html.spec.whatwg.org/multipage/web-sockets.html\n   */\n\n\n  var WebSocket$1 = function (EventTarget$$1) {\n    function WebSocket(url, protocols) {\n      EventTarget$$1.call(this);\n      this._onopen = null;\n      this._onmessage = null;\n      this._onerror = null;\n      this._onclose = null;\n      this.url = urlVerification(url);\n      protocols = protocolVerification(protocols);\n      this.protocol = protocols[0] || '';\n      this.binaryType = 'blob';\n      this.readyState = WebSocket.CONNECTING;\n      var client = proxyFactory(this);\n      var server = networkBridge.attachWebSocket(client, this.url);\n      /*\n       * This delay is needed so that we dont trigger an event before the callbacks have been\n       * setup. For example:\n       *\n       * var socket = new WebSocket('ws://localhost');\n       *\n       * If we dont have the delay then the event would be triggered right here and this is\n       * before the onopen had a chance to register itself.\n       *\n       * socket.onopen = () => { // this would never be called };\n       *\n       * and with the delay the event gets triggered here after all of the callbacks have been\n       * registered :-)\n       */\n\n      delay(function delayCallback() {\n        if (server) {\n          if (server.options.verifyClient && typeof server.options.verifyClient === 'function' && !server.options.verifyClient()) {\n            this.readyState = WebSocket.CLOSED;\n            log('error', \"WebSocket connection to '\" + this.url + \"' failed: HTTP Authentication failed; no valid credentials available\");\n            networkBridge.removeWebSocket(client, this.url);\n            this.dispatchEvent(createEvent({\n              type: 'error',\n              target: this\n            }));\n            this.dispatchEvent(createCloseEvent({\n              type: 'close',\n              target: this,\n              code: CLOSE_CODES.CLOSE_NORMAL\n            }));\n          } else {\n            if (server.options.selectProtocol && typeof server.options.selectProtocol === 'function') {\n              var selectedProtocol = server.options.selectProtocol(protocols);\n              var isFilled = selectedProtocol !== '';\n              var isRequested = protocols.indexOf(selectedProtocol) !== -1;\n\n              if (isFilled && !isRequested) {\n                this.readyState = WebSocket.CLOSED;\n                log('error', \"WebSocket connection to '\" + this.url + \"' failed: Invalid Sub-Protocol\");\n                networkBridge.removeWebSocket(client, this.url);\n                this.dispatchEvent(createEvent({\n                  type: 'error',\n                  target: this\n                }));\n                this.dispatchEvent(createCloseEvent({\n                  type: 'close',\n                  target: this,\n                  code: CLOSE_CODES.CLOSE_NORMAL\n                }));\n                return;\n              }\n\n              this.protocol = selectedProtocol;\n            }\n\n            this.readyState = WebSocket.OPEN;\n            this.dispatchEvent(createEvent({\n              type: 'open',\n              target: this\n            }));\n            server.dispatchEvent(createEvent({\n              type: 'connection'\n            }), client);\n          }\n        } else {\n          this.readyState = WebSocket.CLOSED;\n          this.dispatchEvent(createEvent({\n            type: 'error',\n            target: this\n          }));\n          this.dispatchEvent(createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          }));\n          log('error', \"WebSocket connection to '\" + this.url + \"' failed\");\n        }\n      }, this);\n    }\n\n    if (EventTarget$$1) WebSocket.__proto__ = EventTarget$$1;\n    WebSocket.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    WebSocket.prototype.constructor = WebSocket;\n    var prototypeAccessors = {\n      onopen: {},\n      onmessage: {},\n      onclose: {},\n      onerror: {}\n    };\n\n    prototypeAccessors.onopen.get = function () {\n      return this._onopen;\n    };\n\n    prototypeAccessors.onmessage.get = function () {\n      return this._onmessage;\n    };\n\n    prototypeAccessors.onclose.get = function () {\n      return this._onclose;\n    };\n\n    prototypeAccessors.onerror.get = function () {\n      return this._onerror;\n    };\n\n    prototypeAccessors.onopen.set = function (listener) {\n      this.removeEventListener('open', this._onopen);\n      this._onopen = listener;\n      this.addEventListener('open', listener);\n    };\n\n    prototypeAccessors.onmessage.set = function (listener) {\n      this.removeEventListener('message', this._onmessage);\n      this._onmessage = listener;\n      this.addEventListener('message', listener);\n    };\n\n    prototypeAccessors.onclose.set = function (listener) {\n      this.removeEventListener('close', this._onclose);\n      this._onclose = listener;\n      this.addEventListener('close', listener);\n    };\n\n    prototypeAccessors.onerror.set = function (listener) {\n      this.removeEventListener('error', this._onerror);\n      this._onerror = listener;\n      this.addEventListener('error', listener);\n    };\n\n    WebSocket.prototype.send = function send(data) {\n      var this$1 = this;\n\n      if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n        throw new Error('WebSocket is already in CLOSING or CLOSED state');\n      } // TODO: handle bufferedAmount\n\n\n      var messageEvent = createMessageEvent({\n        type: 'server::message',\n        origin: this.url,\n        data: normalizeSendData(data)\n      });\n      var server = networkBridge.serverLookup(this.url);\n\n      if (server) {\n        delay(function () {\n          this$1.dispatchEvent(messageEvent, data);\n        }, server);\n      }\n    };\n\n    WebSocket.prototype.close = function close(code, reason) {\n      if (code !== undefined) {\n        if (typeof code !== 'number' || code !== 1000 && (code < 3000 || code > 4999)) {\n          throw new TypeError(ERROR_PREFIX.CLOSE_ERROR + \" The code must be either 1000, or between 3000 and 4999. \" + code + \" is neither.\");\n        }\n      }\n\n      if (reason !== undefined) {\n        var length = lengthInUtf8Bytes(reason);\n\n        if (length > 123) {\n          throw new SyntaxError(ERROR_PREFIX.CLOSE_ERROR + \" The message must not be greater than 123 bytes.\");\n        }\n      }\n\n      if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n        return;\n      }\n\n      var client = proxyFactory(this);\n\n      if (this.readyState === WebSocket.CONNECTING) {\n        failWebSocketConnection(client, code || CLOSE_CODES.CLOSE_ABNORMAL, reason);\n      } else {\n        closeWebSocketConnection(client, code || CLOSE_CODES.CLOSE_NO_STATUS, reason);\n      }\n    };\n\n    Object.defineProperties(WebSocket.prototype, prototypeAccessors);\n    return WebSocket;\n  }(EventTarget);\n\n  WebSocket$1.CONNECTING = 0;\n  WebSocket$1.prototype.CONNECTING = WebSocket$1.CONNECTING;\n  WebSocket$1.OPEN = 1;\n  WebSocket$1.prototype.OPEN = WebSocket$1.OPEN;\n  WebSocket$1.CLOSING = 2;\n  WebSocket$1.prototype.CLOSING = WebSocket$1.CLOSING;\n  WebSocket$1.CLOSED = 3;\n  WebSocket$1.prototype.CLOSED = WebSocket$1.CLOSED;\n\n  var dedupe = function (arr) {\n    return arr.reduce(function (deduped, b) {\n      if (deduped.indexOf(b) > -1) {\n        return deduped;\n      }\n\n      return deduped.concat(b);\n    }, []);\n  };\n\n  function retrieveGlobalObject() {\n    if (typeof window !== 'undefined') {\n      return window;\n    }\n\n    return typeof process === 'object' && typeof require === 'function' && typeof global === 'object' ? global : this;\n  }\n\n  var defaultOptions = {\n    mock: true,\n    verifyClient: null,\n    selectProtocol: null\n  };\n\n  var Server$1 = function (EventTarget$$1) {\n    function Server(url, options) {\n      if (options === void 0) options = defaultOptions;\n      EventTarget$$1.call(this);\n      var urlRecord = new urlParse(url);\n\n      if (!urlRecord.pathname) {\n        urlRecord.pathname = '/';\n      }\n\n      this.url = urlRecord.toString();\n      this.originalWebSocket = null;\n      var server = networkBridge.attachServer(this, this.url);\n\n      if (!server) {\n        this.dispatchEvent(createEvent({\n          type: 'error'\n        }));\n        throw new Error('A mock server is already listening on this url');\n      }\n\n      this.options = Object.assign({}, defaultOptions, options);\n\n      if (this.options.mock) {\n        this.mockWebsocket();\n      }\n    }\n\n    if (EventTarget$$1) Server.__proto__ = EventTarget$$1;\n    Server.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    Server.prototype.constructor = Server;\n    /*\n     * Attaches the mock websocket object to the global object\n     */\n\n    Server.prototype.mockWebsocket = function mockWebsocket() {\n      var globalObj = retrieveGlobalObject();\n      this.originalWebSocket = globalObj.WebSocket;\n      globalObj.WebSocket = WebSocket$1;\n    };\n    /*\n     * Removes the mock websocket object from the global object\n     */\n\n\n    Server.prototype.restoreWebsocket = function restoreWebsocket() {\n      var globalObj = retrieveGlobalObject();\n\n      if (this.originalWebSocket !== null) {\n        globalObj.WebSocket = this.originalWebSocket;\n      }\n\n      this.originalWebSocket = null;\n    };\n    /**\n     * Removes itself from the urlMap so another server could add itself to the url.\n     * @param {function} callback - The callback is called when the server is stopped\n     */\n\n\n    Server.prototype.stop = function stop(callback) {\n      if (callback === void 0) callback = function () {};\n\n      if (this.options.mock) {\n        this.restoreWebsocket();\n      }\n\n      networkBridge.removeServer(this.url);\n\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n    /*\n     * This is the main function for the mock server to subscribe to the on events.\n     *\n     * ie: mockServer.on('connection', function() { console.log('a mock client connected'); });\n     *\n     * @param {string} type - The event key to subscribe to. Valid keys are: connection, message, and close.\n     * @param {function} callback - The callback which should be called when a certain event is fired.\n     */\n\n\n    Server.prototype.on = function on(type, callback) {\n      this.addEventListener(type, callback);\n    };\n    /*\n     * Closes the connection and triggers the onclose method of all listening\n     * websockets. After that it removes itself from the urlMap so another server\n     * could add itself to the url.\n     *\n     * @param {object} options\n     */\n\n\n    Server.prototype.close = function close(options) {\n      if (options === void 0) options = {};\n      var code = options.code;\n      var reason = options.reason;\n      var wasClean = options.wasClean;\n      var listeners = networkBridge.websocketsLookup(this.url); // Remove server before notifications to prevent immediate reconnects from\n      // socket onclose handlers\n\n      networkBridge.removeServer(this.url);\n      listeners.forEach(function (socket) {\n        socket.readyState = WebSocket$1.CLOSED;\n        socket.dispatchEvent(createCloseEvent({\n          type: 'close',\n          target: socket.target,\n          code: code || CLOSE_CODES.CLOSE_NORMAL,\n          reason: reason || '',\n          wasClean: wasClean\n        }));\n      });\n      this.dispatchEvent(createCloseEvent({\n        type: 'close'\n      }), this);\n    };\n    /*\n     * Sends a generic message event to all mock clients.\n     */\n\n\n    Server.prototype.emit = function emit(event, data, options) {\n      var this$1 = this;\n      if (options === void 0) options = {};\n      var websockets = options.websockets;\n\n      if (!websockets) {\n        websockets = networkBridge.websocketsLookup(this.url);\n      }\n\n      if (typeof options !== 'object' || arguments.length > 3) {\n        data = Array.prototype.slice.call(arguments, 1, arguments.length);\n        data = data.map(function (item) {\n          return normalizeSendData(item);\n        });\n      } else {\n        data = normalizeSendData(data);\n      }\n\n      websockets.forEach(function (socket) {\n        if (Array.isArray(data)) {\n          socket.dispatchEvent.apply(socket, [createMessageEvent({\n            type: event,\n            data: data,\n            origin: this$1.url,\n            target: socket.target\n          })].concat(data));\n        } else {\n          socket.dispatchEvent(createMessageEvent({\n            type: event,\n            data: data,\n            origin: this$1.url,\n            target: socket.target\n          }));\n        }\n      });\n    };\n    /*\n     * Returns an array of websockets which are listening to this server\n     * TOOD: this should return a set and not be a method\n     */\n\n\n    Server.prototype.clients = function clients() {\n      return networkBridge.websocketsLookup(this.url);\n    };\n    /*\n     * Prepares a method to submit an event to members of the room\n     *\n     * e.g. server.to('my-room').emit('hi!');\n     */\n\n\n    Server.prototype.to = function to(room, broadcaster, broadcastList) {\n      var this$1 = this;\n      if (broadcastList === void 0) broadcastList = [];\n      var self = this;\n      var websockets = dedupe(broadcastList.concat(networkBridge.websocketsLookup(this.url, room, broadcaster)));\n      return {\n        to: function (chainedRoom, chainedBroadcaster) {\n          return this$1.to.call(this$1, chainedRoom, chainedBroadcaster, websockets);\n        },\n        emit: function emit(event, data) {\n          self.emit(event, data, {\n            websockets: websockets\n          });\n        }\n      };\n    };\n    /*\n     * Alias for Server.to\n     */\n\n\n    Server.prototype.in = function in$1() {\n      var args = [],\n          len = arguments.length;\n\n      while (len--) args[len] = arguments[len];\n\n      return this.to.apply(null, args);\n    };\n    /*\n     * Simulate an event from the server to the clients. Useful for\n     * simulating errors.\n     */\n\n\n    Server.prototype.simulate = function simulate(event) {\n      var listeners = networkBridge.websocketsLookup(this.url);\n\n      if (event === 'error') {\n        listeners.forEach(function (socket) {\n          socket.readyState = WebSocket$1.CLOSED;\n          socket.dispatchEvent(createEvent({\n            type: 'error'\n          }));\n        });\n      }\n    };\n\n    return Server;\n  }(EventTarget);\n  /*\n   * Alternative constructor to support namespaces in socket.io\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#custom-namespaces\n   */\n\n\n  Server$1.of = function of(url) {\n    return new Server$1(url);\n  };\n  /*\n   * The socket-io class is designed to mimick the real API as closely as possible.\n   *\n   * http://socket.io/docs/\n   */\n\n\n  var SocketIO$1 = function (EventTarget$$1) {\n    function SocketIO(url, protocol) {\n      var this$1 = this;\n      if (url === void 0) url = 'socket.io';\n      if (protocol === void 0) protocol = '';\n      EventTarget$$1.call(this);\n      this.binaryType = 'blob';\n      var urlRecord = new urlParse(url);\n\n      if (!urlRecord.pathname) {\n        urlRecord.pathname = '/';\n      }\n\n      this.url = urlRecord.toString();\n      this.readyState = SocketIO.CONNECTING;\n      this.protocol = '';\n      this.target = this;\n\n      if (typeof protocol === 'string' || typeof protocol === 'object' && protocol !== null) {\n        this.protocol = protocol;\n      } else if (Array.isArray(protocol) && protocol.length > 0) {\n        this.protocol = protocol[0];\n      }\n\n      var server = networkBridge.attachWebSocket(this, this.url);\n      /*\n       * Delay triggering the connection events so they can be defined in time.\n       */\n\n      delay(function delayCallback() {\n        if (server) {\n          this.readyState = SocketIO.OPEN;\n          server.dispatchEvent(createEvent({\n            type: 'connection'\n          }), server, this);\n          server.dispatchEvent(createEvent({\n            type: 'connect'\n          }), server, this); // alias\n\n          this.dispatchEvent(createEvent({\n            type: 'connect',\n            target: this\n          }));\n        } else {\n          this.readyState = SocketIO.CLOSED;\n          this.dispatchEvent(createEvent({\n            type: 'error',\n            target: this\n          }));\n          this.dispatchEvent(createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          }));\n          log('error', \"Socket.io connection to '\" + this.url + \"' failed\");\n        }\n      }, this);\n      /**\n        Add an aliased event listener for close / disconnect\n       */\n\n      this.addEventListener('close', function (event) {\n        this$1.dispatchEvent(createCloseEvent({\n          type: 'disconnect',\n          target: event.target,\n          code: event.code\n        }));\n      });\n    }\n\n    if (EventTarget$$1) SocketIO.__proto__ = EventTarget$$1;\n    SocketIO.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    SocketIO.prototype.constructor = SocketIO;\n    var prototypeAccessors = {\n      broadcast: {}\n    };\n    /*\n     * Closes the SocketIO connection or connection attempt, if any.\n     * If the connection is already CLOSED, this method does nothing.\n     */\n\n    SocketIO.prototype.close = function close() {\n      if (this.readyState !== SocketIO.OPEN) {\n        return undefined;\n      }\n\n      var server = networkBridge.serverLookup(this.url);\n      networkBridge.removeWebSocket(this, this.url);\n      this.readyState = SocketIO.CLOSED;\n      this.dispatchEvent(createCloseEvent({\n        type: 'close',\n        target: this,\n        code: CLOSE_CODES.CLOSE_NORMAL\n      }));\n\n      if (server) {\n        server.dispatchEvent(createCloseEvent({\n          type: 'disconnect',\n          target: this,\n          code: CLOSE_CODES.CLOSE_NORMAL\n        }), server);\n      }\n\n      return this;\n    };\n    /*\n     * Alias for Socket#close\n     *\n     * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L383\n     */\n\n\n    SocketIO.prototype.disconnect = function disconnect() {\n      return this.close();\n    };\n    /*\n     * Submits an event to the server with a payload\n     */\n\n\n    SocketIO.prototype.emit = function emit(event) {\n      var data = [],\n          len = arguments.length - 1;\n\n      while (len-- > 0) data[len] = arguments[len + 1];\n\n      if (this.readyState !== SocketIO.OPEN) {\n        throw new Error('SocketIO is already in CLOSING or CLOSED state');\n      }\n\n      var messageEvent = createMessageEvent({\n        type: event,\n        origin: this.url,\n        data: data\n      });\n      var server = networkBridge.serverLookup(this.url);\n\n      if (server) {\n        server.dispatchEvent.apply(server, [messageEvent].concat(data));\n      }\n\n      return this;\n    };\n    /*\n     * Submits a 'message' event to the server.\n     *\n     * Should behave exactly like WebSocket#send\n     *\n     * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L113\n     */\n\n\n    SocketIO.prototype.send = function send(data) {\n      this.emit('message', data);\n      return this;\n    };\n    /*\n     * For broadcasting events to other connected sockets.\n     *\n     * e.g. socket.broadcast.emit('hi!');\n     * e.g. socket.broadcast.to('my-room').emit('hi!');\n     */\n\n\n    prototypeAccessors.broadcast.get = function () {\n      if (this.readyState !== SocketIO.OPEN) {\n        throw new Error('SocketIO is already in CLOSING or CLOSED state');\n      }\n\n      var self = this;\n      var server = networkBridge.serverLookup(this.url);\n\n      if (!server) {\n        throw new Error(\"SocketIO can not find a server at the specified URL (\" + this.url + \")\");\n      }\n\n      return {\n        emit: function emit(event, data) {\n          server.emit(event, data, {\n            websockets: networkBridge.websocketsLookup(self.url, null, self)\n          });\n          return self;\n        },\n        to: function to(room) {\n          return server.to(room, self);\n        },\n        in: function in$1(room) {\n          return server.in(room, self);\n        }\n      };\n    };\n    /*\n     * For registering events to be received from the server\n     */\n\n\n    SocketIO.prototype.on = function on(type, callback) {\n      this.addEventListener(type, callback);\n      return this;\n    };\n    /*\n     * Remove event listener\n     *\n     * https://github.com/component/emitter#emitteroffevent-fn\n     */\n\n\n    SocketIO.prototype.off = function off(type, callback) {\n      this.removeEventListener(type, callback);\n    };\n    /*\n     * Check if listeners have already been added for an event\n     *\n     * https://github.com/component/emitter#emitterhaslistenersevent\n     */\n\n\n    SocketIO.prototype.hasListeners = function hasListeners(type) {\n      var listeners = this.listeners[type];\n\n      if (!Array.isArray(listeners)) {\n        return false;\n      }\n\n      return !!listeners.length;\n    };\n    /*\n     * Join a room on a server\n     *\n     * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n     */\n\n\n    SocketIO.prototype.join = function join(room) {\n      networkBridge.addMembershipToRoom(this, room);\n    };\n    /*\n     * Get the websocket to leave the room\n     *\n     * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n     */\n\n\n    SocketIO.prototype.leave = function leave(room) {\n      networkBridge.removeMembershipFromRoom(this, room);\n    };\n\n    SocketIO.prototype.to = function to(room) {\n      return this.broadcast.to(room);\n    };\n\n    SocketIO.prototype.in = function in$1() {\n      return this.to.apply(null, arguments);\n    };\n    /*\n     * Invokes all listener functions that are listening to the given event.type property. Each\n     * listener will be passed the event as the first argument.\n     *\n     * @param {object} event - event object which will be passed to all listeners of the event.type property\n     */\n\n\n    SocketIO.prototype.dispatchEvent = function dispatchEvent(event) {\n      var this$1 = this;\n      var customArguments = [],\n          len = arguments.length - 1;\n\n      while (len-- > 0) customArguments[len] = arguments[len + 1];\n\n      var eventName = event.type;\n      var listeners = this.listeners[eventName];\n\n      if (!Array.isArray(listeners)) {\n        return false;\n      }\n\n      listeners.forEach(function (listener) {\n        if (customArguments.length > 0) {\n          listener.apply(this$1, customArguments);\n        } else {\n          // Regular WebSockets expect a MessageEvent but Socketio.io just wants raw data\n          //  payload instanceof MessageEvent works, but you can't isntance of NodeEvent\n          //  for now we detect if the output has data defined on it\n          listener.call(this$1, event.data ? event.data : event);\n        }\n      });\n    };\n\n    Object.defineProperties(SocketIO.prototype, prototypeAccessors);\n    return SocketIO;\n  }(EventTarget);\n\n  SocketIO$1.CONNECTING = 0;\n  SocketIO$1.OPEN = 1;\n  SocketIO$1.CLOSING = 2;\n  SocketIO$1.CLOSED = 3;\n  /*\n   * Static constructor methods for the IO Socket\n   */\n\n  var IO = function ioConstructor(url, protocol) {\n    return new SocketIO$1(url, protocol);\n  };\n  /*\n   * Alias the raw IO() constructor\n   */\n\n\n  IO.connect = function ioConnect(url, protocol) {\n    /* eslint-disable new-cap */\n    return IO(url, protocol);\n    /* eslint-enable new-cap */\n  };\n\n  var Server = Server$1;\n  var WebSocket = WebSocket$1;\n  var SocketIO = IO;\n  exports.Server = Server;\n  exports.WebSocket = WebSocket;\n  exports.SocketIO = SocketIO;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"names":["global","factory","exports","module","define","amd","Mock","commonjsGlobal","window","self","requiresPort","required","port","protocol","split","has","Object","prototype","hasOwnProperty","undef","decode","input","decodeURIComponent","replace","e","encode","encodeURIComponent","querystring","query","parser","result","part","exec","key","value","querystringify","obj","prefix","pairs","call","isNaN","push","length","join","stringify","parse","querystringify_1","slashes","protocolre","whitespace","left","RegExp","trimLeft","str","toString","rules","sanitize","address","url","isSpecial","NaN","undefined","ignore","hash","lolcation","loc","globalVar","location","finaldestination","type","Url","unescape","pathname","test","href","scheme","extractProtocol","match","toLowerCase","forwardSlashes","otherSlashes","slashesCount","rest","slice","resolve","relative","base","path","concat","i","last","unshift","up","splice","extracted","instruction","index","instructions","indexOf","charAt","host","hostname","username","password","auth","origin","set","fn","pop","char","ins","qs","urlParse","delay","callback","context","setTimeout","timeoutContext","log","method","message","process","env","NODE_ENV","console","reject","array","results","forEach","itemInArray","filter","EventTarget","listeners","addEventListener","listener","Array","isArray","item","removeEventListener","removingListener","arrayOfListeners","dispatchEvent","event","this$1","customArguments","len","arguments","eventName","apply","trimQueryPartFromURL","queryIndex","NetworkBridge","urlMap","attachWebSocket","websocket","serverURL","connectionLookup","server","websockets","addMembershipToRoom","room","roomMemberships","attachServer","serverUrl","serverLookup","websocketsLookup","broadcaster","members","removeServer","removeWebSocket","socket","removeMembershipFromRoom","memberships","networkBridge","CLOSE_CODES","CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","CLOSE_NO_STATUS","CLOSE_ABNORMAL","UNSUPPORTED_DATA","POLICY_VIOLATION","CLOSE_TOO_LARGE","MISSING_EXTENSION","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN_LATER","TLS_HANDSHAKE","ERROR_PREFIX","CONSTRUCTOR_ERROR","CLOSE_ERROR","EVENT","CONSTRUCT","MESSAGE","CLOSE","EventPrototype","stopPropagation","stopImmediatePropagation","initEvent","bubbles","cancelable","Boolean","Event","EventPrototype$$1","eventInitConfig","TypeError","EVENT_ERROR","timeStamp","Date","now","target","srcElement","returnValue","isTrusted","eventPhase","defaultPrevented","currentTarget","cancelBubble","__proto__","create","constructor","MessageEvent","data","lastEventId","ports","canncelBubble","CloseEvent","code","reason","wasClean","parseInt","createEvent","config","eventObject","createMessageEvent","messageEvent","createCloseEvent","closeEvent","closeWebSocketConnection","readyState","WebSocket$1","CLOSING","serverCloseEvent","CLOSED","failWebSocketConnection","errorEvent","normalizeSendData","ArrayBuffer","String","proxies","WeakMap","proxyFactory","get","proxy","Proxy","prop","close","options","send","onWrapper","cb","lengthInUtf8Bytes","m","urlVerification","urlRecord","SyntaxError","protocolVerification","protocols","uniq","map","p","count","reduce","a","b","duplicates","keys","EventTarget$$1","WebSocket","_onopen","_onmessage","_onerror","_onclose","binaryType","CONNECTING","client","delayCallback","verifyClient","selectProtocol","selectedProtocol","isFilled","isRequested","OPEN","prototypeAccessors","onopen","onmessage","onclose","onerror","Error","defineProperties","dedupe","arr","deduped","retrieveGlobalObject","require","defaultOptions","mock","Server$1","Server","originalWebSocket","assign","mockWebsocket","globalObj","restoreWebsocket","stop","on","emit","clients","to","broadcastList","chainedRoom","chainedBroadcaster","in","in$1","args","simulate","of","SocketIO$1","SocketIO","broadcast","disconnect","off","hasListeners","leave","IO","ioConstructor","connect","ioConnect","defineProperty"],"sources":["/Users/mcakmakali/Desktop/redux-example/node_modules/mock-socket/dist/mock-socket.js"],"sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.Mock = global.Mock || {})));\n}(this, (function (exports) { 'use strict';\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nvar requiresPort = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) { return false; }\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n\nvar has = Object.prototype.hasOwnProperty;\nvar undef;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String|Null} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  try {\n    return decodeURIComponent(input.replace(/\\+/g, ' '));\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Attempts to encode a given input.\n *\n * @param {String} input The string that needs to be encoded.\n * @returns {String|Null} The encoded string.\n * @api private\n */\nfunction encode(input) {\n  try {\n    return encodeURIComponent(input);\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?#&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  while (part = parser.exec(query)) {\n    var key = decode(part[1])\n      , value = decode(part[2]);\n\n    //\n    // Prevent overriding of existing properties. This ensures that build-in\n    // methods like `toString` or __proto__ are not overriden by malicious\n    // querystrings.\n    //\n    // In the case if failed decoding, we want to omit the key/value pairs\n    // from the result.\n    //\n    if (key === null || value === null || key in result) { continue; }\n    result[key] = value;\n  }\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = []\n    , value\n    , key;\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) { prefix = '?'; }\n\n  for (key in obj) {\n    if (has.call(obj, key)) {\n      value = obj[key];\n\n      //\n      // Edge cases where we actually want to encode the value to an empty\n      // string instead of the stringified value.\n      //\n      if (!value && (value === null || value === undef || isNaN(value))) {\n        value = '';\n      }\n\n      key = encode(key);\n      value = encode(value);\n\n      //\n      // If we failed to encode the strings, we should bail out as we don't\n      // want to add invalid strings to the query.\n      //\n      if (key === null || value === null) { continue; }\n      pairs.push(key +'='+ value);\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nvar stringify = querystringify;\nvar parse = querystring;\n\nvar querystringify_1 = {\n\tstringify: stringify,\n\tparse: parse\n};\n\nvar slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\nvar protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\\\/]+)?([\\S\\s]*)/i;\nvar whitespace = '[\\\\x09\\\\x0A\\\\x0B\\\\x0C\\\\x0D\\\\x20\\\\xA0\\\\u1680\\\\u180E\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200A\\\\u202F\\\\u205F\\\\u3000\\\\u2028\\\\u2029\\\\uFEFF]';\nvar left = new RegExp('^'+ whitespace +'+');\n\n/**\n * Trim a given string.\n *\n * @param {String} str String to trim.\n * @public\n */\nfunction trimLeft(str) {\n  return (str ? str : '').toString().replace(left, '');\n}\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  function sanitize(address, url) {     // Sanitize what is left of the address\n    return isSpecial(url.protocol) ? address.replace(/\\\\/g, '/') : address;\n  },\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @public\n */\nfunction lolcation(loc) {\n  var globalVar;\n\n  if (typeof window !== 'undefined') { globalVar = window; }\n  else if (typeof commonjsGlobal !== 'undefined') { globalVar = commonjsGlobal; }\n  else if (typeof self !== 'undefined') { globalVar = self; }\n  else { globalVar = {}; }\n\n  var location = globalVar.location || {};\n  loc = loc || location;\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new Url(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new Url(loc, {});\n    for (key in ignore) { delete finaldestination[key]; }\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) { continue; }\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * Check whether a protocol scheme is special.\n *\n * @param {String} The protocol scheme of the URL\n * @return {Boolean} `true` if the protocol scheme is special, else `false`\n * @private\n */\nfunction isSpecial(scheme) {\n  return (\n    scheme === 'file:' ||\n    scheme === 'ftp:' ||\n    scheme === 'http:' ||\n    scheme === 'https:' ||\n    scheme === 'ws:' ||\n    scheme === 'wss:'\n  );\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @param {Object} location\n * @return {ProtocolExtract} Extracted information.\n * @private\n */\nfunction extractProtocol(address, location) {\n  address = trimLeft(address);\n  location = location || {};\n\n  var match = protocolre.exec(address);\n  var protocol = match[1] ? match[1].toLowerCase() : '';\n  var forwardSlashes = !!match[2];\n  var otherSlashes = !!match[3];\n  var slashesCount = 0;\n  var rest;\n\n  if (forwardSlashes) {\n    if (otherSlashes) {\n      rest = match[2] + match[3] + match[4];\n      slashesCount = match[2].length + match[3].length;\n    } else {\n      rest = match[2] + match[4];\n      slashesCount = match[2].length;\n    }\n  } else {\n    if (otherSlashes) {\n      rest = match[3] + match[4];\n      slashesCount = match[3].length;\n    } else {\n      rest = match[4];\n    }\n  }\n\n  if (protocol === 'file:') {\n    if (slashesCount >= 2) {\n      rest = rest.slice(2);\n    }\n  } else if (isSpecial(protocol)) {\n    rest = match[4];\n  } else if (protocol) {\n    if (forwardSlashes) {\n      rest = rest.slice(2);\n    }\n  } else if (slashesCount >= 2 && isSpecial(location.protocol)) {\n    rest = match[4];\n  }\n\n  return {\n    protocol: protocol,\n    slashes: forwardSlashes || isSpecial(protocol),\n    slashesCount: slashesCount,\n    rest: rest\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @private\n */\nfunction resolve(relative, base) {\n  if (relative === '') { return base; }\n\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) { unshift = true; }\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) { path.unshift(''); }\n  if (last === '.' || last === '..') { path.push(''); }\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * It is worth noting that we should not use `URL` as class name to prevent\n * clashes with the global URL instance that got introduced in browsers.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} [location] Location defaults for relative paths.\n * @param {Boolean|Function} [parser] Parser for the query string.\n * @private\n */\nfunction Url(address, location, parser) {\n  address = trimLeft(address);\n\n  if (!(this instanceof Url)) {\n    return new Url(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) { parser = querystringify_1.parse; }\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '', location);\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (\n    url.protocol === 'file:' ||\n    (!extracted.slashes &&\n      (extracted.protocol ||\n        extracted.slashesCount < 2 ||\n        !isSpecial(url.protocol)))\n  ) {\n    instructions[3] = [/(.*)/, 'pathname'];\n  }\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n\n    if (typeof instruction === 'function') {\n      address = instruction(address, url);\n      continue;\n    }\n\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) { url[key] = url[key].toLowerCase(); }\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) { url.query = parser(url.query); }\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // Default to a / for pathname if none exists. This normalizes the URL\n  // to always have a /\n  //\n  if (url.pathname.charAt(0) !== '/' && isSpecial(url.protocol)) {\n    url.pathname = '/' + url.pathname;\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!requiresPort(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL} URL instance for chaining.\n * @public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || querystringify_1.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!requiresPort(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) { value += ':'+ url.port; }\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    default:\n      url[part] = value;\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) { url[ins[1]] = url[ins[1]].toLowerCase(); }\n  }\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String} Compiled version of the URL.\n * @public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) { stringify = querystringify_1.stringify; }\n\n  var query\n    , url = this\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') { protocol += ':'; }\n\n  var result = protocol + (url.slashes || isSpecial(url.protocol) ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) { result += ':'+ url.password; }\n    result += '@';\n  }\n\n  result += url.host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) { result += '?' !== query.charAt(0) ? '?'+ query : query; }\n\n  if (url.hash) { result += url.hash; }\n\n  return result;\n}\n\nUrl.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nUrl.extractProtocol = extractProtocol;\nUrl.location = lolcation;\nUrl.trimLeft = trimLeft;\nUrl.qs = querystringify_1;\n\nvar urlParse = Url;\n\n/*\n * This delay allows the thread to finish assigning its on* methods\n * before invoking the delay callback. This is purely a timing hack.\n * http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html\n *\n * @param {callback: function} the callback which will be invoked after the timeout\n * @parma {context: object} the context in which to invoke the function\n */\nfunction delay(callback, context) {\n  setTimeout(function (timeoutContext) { return callback.call(timeoutContext); }, 4, context);\n}\n\nfunction log(method, message) {\n  /* eslint-disable no-console */\n  if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'test') {\n    console[method].call(null, message);\n  }\n  /* eslint-enable no-console */\n}\n\nfunction reject(array, callback) {\n  if ( array === void 0 ) array = [];\n\n  var results = [];\n  array.forEach(function (itemInArray) {\n    if (!callback(itemInArray)) {\n      results.push(itemInArray);\n    }\n  });\n\n  return results;\n}\n\nfunction filter(array, callback) {\n  if ( array === void 0 ) array = [];\n\n  var results = [];\n  array.forEach(function (itemInArray) {\n    if (callback(itemInArray)) {\n      results.push(itemInArray);\n    }\n  });\n\n  return results;\n}\n\n/*\n * EventTarget is an interface implemented by objects that can\n * receive events and may have listeners for them.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n */\nvar EventTarget = function EventTarget() {\n  this.listeners = {};\n};\n\n/*\n * Ties a listener function to an event type which can later be invoked via the\n * dispatchEvent method.\n *\n * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n */\nEventTarget.prototype.addEventListener = function addEventListener (type, listener /* , useCapture */) {\n  if (typeof listener === 'function') {\n    if (!Array.isArray(this.listeners[type])) {\n      this.listeners[type] = [];\n    }\n\n    // Only add the same function once\n    if (filter(this.listeners[type], function (item) { return item === listener; }).length === 0) {\n      this.listeners[type].push(listener);\n    }\n  }\n};\n\n/*\n * Removes the listener so it will no longer be invoked via the dispatchEvent method.\n *\n * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n */\nEventTarget.prototype.removeEventListener = function removeEventListener (type, removingListener /* , useCapture */) {\n  var arrayOfListeners = this.listeners[type];\n  this.listeners[type] = reject(arrayOfListeners, function (listener) { return listener === removingListener; });\n};\n\n/*\n * Invokes all listener functions that are listening to the given event.type property. Each\n * listener will be passed the event as the first argument.\n *\n * @param {object} event - event object which will be passed to all listeners of the event.type property\n */\nEventTarget.prototype.dispatchEvent = function dispatchEvent (event) {\n    var this$1 = this;\n    var customArguments = [], len = arguments.length - 1;\n    while ( len-- > 0 ) customArguments[ len ] = arguments[ len + 1 ];\n\n  var eventName = event.type;\n  var listeners = this.listeners[eventName];\n\n  if (!Array.isArray(listeners)) {\n    return false;\n  }\n\n  listeners.forEach(function (listener) {\n    if (customArguments.length > 0) {\n      listener.apply(this$1, customArguments);\n    } else {\n      listener.call(this$1, event);\n    }\n  });\n\n  return true;\n};\n\nfunction trimQueryPartFromURL(url) {\n  var queryIndex = url.indexOf('?');\n  return queryIndex >= 0 ? url.slice(0, queryIndex) : url;\n}\n\n/*\n * The network bridge is a way for the mock websocket object to 'communicate' with\n * all available servers. This is a singleton object so it is important that you\n * clean up urlMap whenever you are finished.\n */\nvar NetworkBridge = function NetworkBridge() {\n  this.urlMap = {};\n};\n\n/*\n * Attaches a websocket object to the urlMap hash so that it can find the server\n * it is connected to and the server in turn can find it.\n *\n * @param {object} websocket - websocket object to add to the urlMap hash\n * @param {string} url\n */\nNetworkBridge.prototype.attachWebSocket = function attachWebSocket (websocket, url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) === -1) {\n    connectionLookup.websockets.push(websocket);\n    return connectionLookup.server;\n  }\n};\n\n/*\n * Attaches a websocket to a room\n */\nNetworkBridge.prototype.addMembershipToRoom = function addMembershipToRoom (websocket, room) {\n  var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n\n  if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) !== -1) {\n    if (!connectionLookup.roomMemberships[room]) {\n      connectionLookup.roomMemberships[room] = [];\n    }\n\n    connectionLookup.roomMemberships[room].push(websocket);\n  }\n};\n\n/*\n * Attaches a server object to the urlMap hash so that it can find a websockets\n * which are connected to it and so that websockets can in turn can find it.\n *\n * @param {object} server - server object to add to the urlMap hash\n * @param {string} url\n */\nNetworkBridge.prototype.attachServer = function attachServer (server, url) {\n  var serverUrl = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverUrl];\n\n  if (!connectionLookup) {\n    this.urlMap[serverUrl] = {\n      server: server,\n      websockets: [],\n      roomMemberships: {}\n    };\n\n    return server;\n  }\n};\n\n/*\n * Finds the server which is 'running' on the given url.\n *\n * @param {string} url - the url to use to find which server is running on it\n */\nNetworkBridge.prototype.serverLookup = function serverLookup (url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup) {\n    return connectionLookup.server;\n  }\n};\n\n/*\n * Finds all websockets which is 'listening' on the given url.\n *\n * @param {string} url - the url to use to find all websockets which are associated with it\n * @param {string} room - if a room is provided, will only return sockets in this room\n * @param {class} broadcaster - socket that is broadcasting and is to be excluded from the lookup\n */\nNetworkBridge.prototype.websocketsLookup = function websocketsLookup (url, room, broadcaster) {\n  var serverURL = trimQueryPartFromURL(url);\n  var websockets;\n  var connectionLookup = this.urlMap[serverURL];\n\n  websockets = connectionLookup ? connectionLookup.websockets : [];\n\n  if (room) {\n    var members = connectionLookup.roomMemberships[room];\n    websockets = members || [];\n  }\n\n  return broadcaster ? websockets.filter(function (websocket) { return websocket !== broadcaster; }) : websockets;\n};\n\n/*\n * Removes the entry associated with the url.\n *\n * @param {string} url\n */\nNetworkBridge.prototype.removeServer = function removeServer (url) {\n  delete this.urlMap[trimQueryPartFromURL(url)];\n};\n\n/*\n * Removes the individual websocket from the map of associated websockets.\n *\n * @param {object} websocket - websocket object to remove from the url map\n * @param {string} url\n */\nNetworkBridge.prototype.removeWebSocket = function removeWebSocket (websocket, url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup) {\n    connectionLookup.websockets = reject(connectionLookup.websockets, function (socket) { return socket === websocket; });\n  }\n};\n\n/*\n * Removes a websocket from a room\n */\nNetworkBridge.prototype.removeMembershipFromRoom = function removeMembershipFromRoom (websocket, room) {\n  var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n  var memberships = connectionLookup.roomMemberships[room];\n\n  if (connectionLookup && memberships !== null) {\n    connectionLookup.roomMemberships[room] = reject(memberships, function (socket) { return socket === websocket; });\n  }\n};\n\nvar networkBridge = new NetworkBridge(); // Note: this is a singleton\n\n/*\n * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n */\nvar CLOSE_CODES = {\n  CLOSE_NORMAL: 1000,\n  CLOSE_GOING_AWAY: 1001,\n  CLOSE_PROTOCOL_ERROR: 1002,\n  CLOSE_UNSUPPORTED: 1003,\n  CLOSE_NO_STATUS: 1005,\n  CLOSE_ABNORMAL: 1006,\n  UNSUPPORTED_DATA: 1007,\n  POLICY_VIOLATION: 1008,\n  CLOSE_TOO_LARGE: 1009,\n  MISSING_EXTENSION: 1010,\n  INTERNAL_ERROR: 1011,\n  SERVICE_RESTART: 1012,\n  TRY_AGAIN_LATER: 1013,\n  TLS_HANDSHAKE: 1015\n};\n\nvar ERROR_PREFIX = {\n  CONSTRUCTOR_ERROR: \"Failed to construct 'WebSocket':\",\n  CLOSE_ERROR: \"Failed to execute 'close' on 'WebSocket':\",\n  EVENT: {\n    CONSTRUCT: \"Failed to construct 'Event':\",\n    MESSAGE: \"Failed to construct 'MessageEvent':\",\n    CLOSE: \"Failed to construct 'CloseEvent':\"\n  }\n};\n\nvar EventPrototype = function EventPrototype () {};\n\nEventPrototype.prototype.stopPropagation = function stopPropagation () {};\nEventPrototype.prototype.stopImmediatePropagation = function stopImmediatePropagation () {};\n\n// if no arguments are passed then the type is set to \"undefined\" on\n// chrome and safari.\nEventPrototype.prototype.initEvent = function initEvent (type, bubbles, cancelable) {\n    if ( type === void 0 ) type = 'undefined';\n    if ( bubbles === void 0 ) bubbles = false;\n    if ( cancelable === void 0 ) cancelable = false;\n\n  this.type = \"\" + type;\n  this.bubbles = Boolean(bubbles);\n  this.cancelable = Boolean(cancelable);\n};\n\nvar Event = (function (EventPrototype$$1) {\n  function Event(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT_ERROR) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT_ERROR) + \" parameter 2 ('eventInitDict') is not an object.\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.cancelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n  }\n\n  if ( EventPrototype$$1 ) Event.__proto__ = EventPrototype$$1;\n  Event.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  Event.prototype.constructor = Event;\n\n  return Event;\n}(EventPrototype));\n\nvar MessageEvent = (function (EventPrototype$$1) {\n  function MessageEvent(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT.MESSAGE) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT.MESSAGE) + \" parameter 2 ('eventInitDict') is not an object\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n    var data = eventInitConfig.data;\n    var origin = eventInitConfig.origin;\n    var lastEventId = eventInitConfig.lastEventId;\n    var ports = eventInitConfig.ports;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.canncelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n    this.origin = \"\" + origin;\n    this.ports = typeof ports === 'undefined' ? null : ports;\n    this.data = typeof data === 'undefined' ? null : data;\n    this.lastEventId = \"\" + (lastEventId || '');\n  }\n\n  if ( EventPrototype$$1 ) MessageEvent.__proto__ = EventPrototype$$1;\n  MessageEvent.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  MessageEvent.prototype.constructor = MessageEvent;\n\n  return MessageEvent;\n}(EventPrototype));\n\nvar CloseEvent = (function (EventPrototype$$1) {\n  function CloseEvent(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT.CLOSE) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT.CLOSE) + \" parameter 2 ('eventInitDict') is not an object\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n    var code = eventInitConfig.code;\n    var reason = eventInitConfig.reason;\n    var wasClean = eventInitConfig.wasClean;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.cancelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n    this.code = typeof code === 'number' ? parseInt(code, 10) : 0;\n    this.reason = \"\" + (reason || '');\n    this.wasClean = wasClean ? Boolean(wasClean) : false;\n  }\n\n  if ( EventPrototype$$1 ) CloseEvent.__proto__ = EventPrototype$$1;\n  CloseEvent.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  CloseEvent.prototype.constructor = CloseEvent;\n\n  return CloseEvent;\n}(EventPrototype));\n\n/*\n * Creates an Event object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config you will need to pass type and optionally target\n */\nfunction createEvent(config) {\n  var type = config.type;\n  var target = config.target;\n  var eventObject = new Event(type);\n\n  if (target) {\n    eventObject.target = target;\n    eventObject.srcElement = target;\n    eventObject.currentTarget = target;\n  }\n\n  return eventObject;\n}\n\n/*\n * Creates a MessageEvent object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config: type, origin, data and optionally target\n */\nfunction createMessageEvent(config) {\n  var type = config.type;\n  var origin = config.origin;\n  var data = config.data;\n  var target = config.target;\n  var messageEvent = new MessageEvent(type, {\n    data: data,\n    origin: origin\n  });\n\n  if (target) {\n    messageEvent.target = target;\n    messageEvent.srcElement = target;\n    messageEvent.currentTarget = target;\n  }\n\n  return messageEvent;\n}\n\n/*\n * Creates a CloseEvent object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config: type and optionally target, code, and reason\n */\nfunction createCloseEvent(config) {\n  var code = config.code;\n  var reason = config.reason;\n  var type = config.type;\n  var target = config.target;\n  var wasClean = config.wasClean;\n\n  if (!wasClean) {\n    wasClean = code === CLOSE_CODES.CLOSE_NORMAL || code === CLOSE_CODES.CLOSE_NO_STATUS;\n  }\n\n  var closeEvent = new CloseEvent(type, {\n    code: code,\n    reason: reason,\n    wasClean: wasClean\n  });\n\n  if (target) {\n    closeEvent.target = target;\n    closeEvent.srcElement = target;\n    closeEvent.currentTarget = target;\n  }\n\n  return closeEvent;\n}\n\nfunction closeWebSocketConnection(context, code, reason) {\n  context.readyState = WebSocket$1.CLOSING;\n\n  var server = networkBridge.serverLookup(context.url);\n  var closeEvent = createCloseEvent({\n    type: 'close',\n    target: context.target,\n    code: code,\n    reason: reason\n  });\n  var serverCloseEvent = createCloseEvent({\n    type: 'server::close',\n    target: context,\n    code: code,\n    reason: reason\n  });\n\n  delay(function () {\n    networkBridge.removeWebSocket(context, context.url);\n\n    context.readyState = WebSocket$1.CLOSED;\n    context.dispatchEvent(closeEvent);\n    context.dispatchEvent(serverCloseEvent);\n\n    if (server) {\n      server.dispatchEvent(closeEvent, server);\n    }\n  }, context);\n}\n\nfunction failWebSocketConnection(context, code, reason) {\n  context.readyState = WebSocket$1.CLOSING;\n\n  var server = networkBridge.serverLookup(context.url);\n  var closeEvent = createCloseEvent({\n    type: 'close',\n    target: context.target,\n    code: code,\n    reason: reason,\n    wasClean: false\n  });\n  var serverCloseEvent = createCloseEvent({\n    type: 'server::close',\n    target: context,\n    code: code,\n    reason: reason,\n    wasClean: false\n  });\n\n  var errorEvent = createEvent({\n    type: 'error',\n    target: context.target\n  });\n\n  delay(function () {\n    networkBridge.removeWebSocket(context, context.url);\n\n    context.readyState = WebSocket$1.CLOSED;\n    context.dispatchEvent(errorEvent);\n    context.dispatchEvent(closeEvent);\n    context.dispatchEvent(serverCloseEvent);\n\n    if (server) {\n      server.dispatchEvent(closeEvent, server);\n    }\n  }, context);\n}\n\nfunction normalizeSendData(data) {\n  if (Object.prototype.toString.call(data) !== '[object Blob]' && !(data instanceof ArrayBuffer)) {\n    data = String(data);\n  }\n\n  return data;\n}\n\nvar proxies = new WeakMap();\n\nfunction proxyFactory(target) {\n  if (proxies.has(target)) {\n    return proxies.get(target);\n  }\n\n  var proxy = new Proxy(target, {\n    get: function get(obj, prop) {\n      if (prop === 'close') {\n        return function close(options) {\n          if ( options === void 0 ) options = {};\n\n          var code = options.code || CLOSE_CODES.CLOSE_NORMAL;\n          var reason = options.reason || '';\n\n          closeWebSocketConnection(proxy, code, reason);\n        };\n      }\n\n      if (prop === 'send') {\n        return function send(data) {\n          data = normalizeSendData(data);\n\n          target.dispatchEvent(\n            createMessageEvent({\n              type: 'message',\n              data: data,\n              origin: this.url,\n              target: target\n            })\n          );\n        };\n      }\n\n      if (prop === 'on') {\n        return function onWrapper(type, cb) {\n          target.addEventListener((\"server::\" + type), cb);\n        };\n      }\n\n      if (prop === 'target') {\n        return target;\n      }\n\n      return obj[prop];\n    }\n  });\n  proxies.set(target, proxy);\n\n  return proxy;\n}\n\nfunction lengthInUtf8Bytes(str) {\n  // Matches only the 10.. bytes that are non-initial characters in a multi-byte sequence.\n  var m = encodeURIComponent(str).match(/%[89ABab]/g);\n  return str.length + (m ? m.length : 0);\n}\n\nfunction urlVerification(url) {\n  var urlRecord = new urlParse(url);\n  var pathname = urlRecord.pathname;\n  var protocol = urlRecord.protocol;\n  var hash = urlRecord.hash;\n\n  if (!url) {\n    throw new TypeError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" 1 argument required, but only 0 present.\"));\n  }\n\n  if (!pathname) {\n    urlRecord.pathname = '/';\n  }\n\n  if (protocol === '') {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL '\" + (urlRecord.toString()) + \"' is invalid.\"));\n  }\n\n  if (protocol !== 'ws:' && protocol !== 'wss:') {\n    throw new SyntaxError(\n      ((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL's scheme must be either 'ws' or 'wss'. '\" + protocol + \"' is not allowed.\")\n    );\n  }\n\n  if (hash !== '') {\n    /* eslint-disable max-len */\n    throw new SyntaxError(\n      ((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL contains a fragment identifier ('\" + hash + \"'). Fragment identifiers are not allowed in WebSocket URLs.\")\n    );\n    /* eslint-enable max-len */\n  }\n\n  return urlRecord.toString();\n}\n\nfunction protocolVerification(protocols) {\n  if ( protocols === void 0 ) protocols = [];\n\n  if (!Array.isArray(protocols) && typeof protocols !== 'string') {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The subprotocol '\" + (protocols.toString()) + \"' is invalid.\"));\n  }\n\n  if (typeof protocols === 'string') {\n    protocols = [protocols];\n  }\n\n  var uniq = protocols\n    .map(function (p) { return ({ count: 1, protocol: p }); })\n    .reduce(function (a, b) {\n      a[b.protocol] = (a[b.protocol] || 0) + b.count;\n      return a;\n    }, {});\n\n  var duplicates = Object.keys(uniq).filter(function (a) { return uniq[a] > 1; });\n\n  if (duplicates.length > 0) {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The subprotocol '\" + (duplicates[0]) + \"' is duplicated.\"));\n  }\n\n  return protocols;\n}\n\n/*\n * The main websocket class which is designed to mimick the native WebSocket class as close\n * as possible.\n *\n * https://html.spec.whatwg.org/multipage/web-sockets.html\n */\nvar WebSocket$1 = (function (EventTarget$$1) {\n  function WebSocket(url, protocols) {\n    EventTarget$$1.call(this);\n\n    this._onopen = null;\n    this._onmessage = null;\n    this._onerror = null;\n    this._onclose = null;\n\n    this.url = urlVerification(url);\n    protocols = protocolVerification(protocols);\n    this.protocol = protocols[0] || '';\n\n    this.binaryType = 'blob';\n    this.readyState = WebSocket.CONNECTING;\n\n    var client = proxyFactory(this);\n    var server = networkBridge.attachWebSocket(client, this.url);\n\n    /*\n     * This delay is needed so that we dont trigger an event before the callbacks have been\n     * setup. For example:\n     *\n     * var socket = new WebSocket('ws://localhost');\n     *\n     * If we dont have the delay then the event would be triggered right here and this is\n     * before the onopen had a chance to register itself.\n     *\n     * socket.onopen = () => { // this would never be called };\n     *\n     * and with the delay the event gets triggered here after all of the callbacks have been\n     * registered :-)\n     */\n    delay(function delayCallback() {\n      if (server) {\n        if (\n          server.options.verifyClient &&\n          typeof server.options.verifyClient === 'function' &&\n          !server.options.verifyClient()\n        ) {\n          this.readyState = WebSocket.CLOSED;\n\n          log(\n            'error',\n            (\"WebSocket connection to '\" + (this.url) + \"' failed: HTTP Authentication failed; no valid credentials available\")\n          );\n\n          networkBridge.removeWebSocket(client, this.url);\n          this.dispatchEvent(createEvent({ type: 'error', target: this }));\n          this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n        } else {\n          if (server.options.selectProtocol && typeof server.options.selectProtocol === 'function') {\n            var selectedProtocol = server.options.selectProtocol(protocols);\n            var isFilled = selectedProtocol !== '';\n            var isRequested = protocols.indexOf(selectedProtocol) !== -1;\n            if (isFilled && !isRequested) {\n              this.readyState = WebSocket.CLOSED;\n\n              log('error', (\"WebSocket connection to '\" + (this.url) + \"' failed: Invalid Sub-Protocol\"));\n\n              networkBridge.removeWebSocket(client, this.url);\n              this.dispatchEvent(createEvent({ type: 'error', target: this }));\n              this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n              return;\n            }\n            this.protocol = selectedProtocol;\n          }\n          this.readyState = WebSocket.OPEN;\n          this.dispatchEvent(createEvent({ type: 'open', target: this }));\n          server.dispatchEvent(createEvent({ type: 'connection' }), client);\n        }\n      } else {\n        this.readyState = WebSocket.CLOSED;\n        this.dispatchEvent(createEvent({ type: 'error', target: this }));\n        this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n\n        log('error', (\"WebSocket connection to '\" + (this.url) + \"' failed\"));\n      }\n    }, this);\n  }\n\n  if ( EventTarget$$1 ) WebSocket.__proto__ = EventTarget$$1;\n  WebSocket.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  WebSocket.prototype.constructor = WebSocket;\n\n  var prototypeAccessors = { onopen: {},onmessage: {},onclose: {},onerror: {} };\n\n  prototypeAccessors.onopen.get = function () {\n    return this._onopen;\n  };\n\n  prototypeAccessors.onmessage.get = function () {\n    return this._onmessage;\n  };\n\n  prototypeAccessors.onclose.get = function () {\n    return this._onclose;\n  };\n\n  prototypeAccessors.onerror.get = function () {\n    return this._onerror;\n  };\n\n  prototypeAccessors.onopen.set = function (listener) {\n    this.removeEventListener('open', this._onopen);\n    this._onopen = listener;\n    this.addEventListener('open', listener);\n  };\n\n  prototypeAccessors.onmessage.set = function (listener) {\n    this.removeEventListener('message', this._onmessage);\n    this._onmessage = listener;\n    this.addEventListener('message', listener);\n  };\n\n  prototypeAccessors.onclose.set = function (listener) {\n    this.removeEventListener('close', this._onclose);\n    this._onclose = listener;\n    this.addEventListener('close', listener);\n  };\n\n  prototypeAccessors.onerror.set = function (listener) {\n    this.removeEventListener('error', this._onerror);\n    this._onerror = listener;\n    this.addEventListener('error', listener);\n  };\n\n  WebSocket.prototype.send = function send (data) {\n    var this$1 = this;\n\n    if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n      throw new Error('WebSocket is already in CLOSING or CLOSED state');\n    }\n\n    // TODO: handle bufferedAmount\n\n    var messageEvent = createMessageEvent({\n      type: 'server::message',\n      origin: this.url,\n      data: normalizeSendData(data)\n    });\n\n    var server = networkBridge.serverLookup(this.url);\n\n    if (server) {\n      delay(function () {\n        this$1.dispatchEvent(messageEvent, data);\n      }, server);\n    }\n  };\n\n  WebSocket.prototype.close = function close (code, reason) {\n    if (code !== undefined) {\n      if (typeof code !== 'number' || (code !== 1000 && (code < 3000 || code > 4999))) {\n        throw new TypeError(\n          ((ERROR_PREFIX.CLOSE_ERROR) + \" The code must be either 1000, or between 3000 and 4999. \" + code + \" is neither.\")\n        );\n      }\n    }\n\n    if (reason !== undefined) {\n      var length = lengthInUtf8Bytes(reason);\n\n      if (length > 123) {\n        throw new SyntaxError(((ERROR_PREFIX.CLOSE_ERROR) + \" The message must not be greater than 123 bytes.\"));\n      }\n    }\n\n    if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n      return;\n    }\n\n    var client = proxyFactory(this);\n    if (this.readyState === WebSocket.CONNECTING) {\n      failWebSocketConnection(client, code || CLOSE_CODES.CLOSE_ABNORMAL, reason);\n    } else {\n      closeWebSocketConnection(client, code || CLOSE_CODES.CLOSE_NO_STATUS, reason);\n    }\n  };\n\n  Object.defineProperties( WebSocket.prototype, prototypeAccessors );\n\n  return WebSocket;\n}(EventTarget));\n\nWebSocket$1.CONNECTING = 0;\nWebSocket$1.prototype.CONNECTING = WebSocket$1.CONNECTING;\nWebSocket$1.OPEN = 1;\nWebSocket$1.prototype.OPEN = WebSocket$1.OPEN;\nWebSocket$1.CLOSING = 2;\nWebSocket$1.prototype.CLOSING = WebSocket$1.CLOSING;\nWebSocket$1.CLOSED = 3;\nWebSocket$1.prototype.CLOSED = WebSocket$1.CLOSED;\n\nvar dedupe = function (arr) { return arr.reduce(function (deduped, b) {\n    if (deduped.indexOf(b) > -1) { return deduped; }\n    return deduped.concat(b);\n  }, []); };\n\nfunction retrieveGlobalObject() {\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n\n  return typeof process === 'object' && typeof require === 'function' && typeof global === 'object' ? global : this;\n}\n\nvar defaultOptions = {\n  mock: true,\n  verifyClient: null,\n  selectProtocol: null\n};\n\nvar Server$1 = (function (EventTarget$$1) {\n  function Server(url, options) {\n    if ( options === void 0 ) options = defaultOptions;\n\n    EventTarget$$1.call(this);\n    var urlRecord = new urlParse(url);\n\n    if (!urlRecord.pathname) {\n      urlRecord.pathname = '/';\n    }\n\n    this.url = urlRecord.toString();\n\n    this.originalWebSocket = null;\n    var server = networkBridge.attachServer(this, this.url);\n\n    if (!server) {\n      this.dispatchEvent(createEvent({ type: 'error' }));\n      throw new Error('A mock server is already listening on this url');\n    }\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    if (this.options.mock) {\n      this.mockWebsocket();\n    }\n  }\n\n  if ( EventTarget$$1 ) Server.__proto__ = EventTarget$$1;\n  Server.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  Server.prototype.constructor = Server;\n\n  /*\n   * Attaches the mock websocket object to the global object\n   */\n  Server.prototype.mockWebsocket = function mockWebsocket () {\n    var globalObj = retrieveGlobalObject();\n\n    this.originalWebSocket = globalObj.WebSocket;\n    globalObj.WebSocket = WebSocket$1;\n  };\n\n  /*\n   * Removes the mock websocket object from the global object\n   */\n  Server.prototype.restoreWebsocket = function restoreWebsocket () {\n    var globalObj = retrieveGlobalObject();\n\n    if (this.originalWebSocket !== null) {\n      globalObj.WebSocket = this.originalWebSocket;\n    }\n\n    this.originalWebSocket = null;\n  };\n\n  /**\n   * Removes itself from the urlMap so another server could add itself to the url.\n   * @param {function} callback - The callback is called when the server is stopped\n   */\n  Server.prototype.stop = function stop (callback) {\n    if ( callback === void 0 ) callback = function () {};\n\n    if (this.options.mock) {\n      this.restoreWebsocket();\n    }\n\n    networkBridge.removeServer(this.url);\n\n    if (typeof callback === 'function') {\n      callback();\n    }\n  };\n\n  /*\n   * This is the main function for the mock server to subscribe to the on events.\n   *\n   * ie: mockServer.on('connection', function() { console.log('a mock client connected'); });\n   *\n   * @param {string} type - The event key to subscribe to. Valid keys are: connection, message, and close.\n   * @param {function} callback - The callback which should be called when a certain event is fired.\n   */\n  Server.prototype.on = function on (type, callback) {\n    this.addEventListener(type, callback);\n  };\n\n  /*\n   * Closes the connection and triggers the onclose method of all listening\n   * websockets. After that it removes itself from the urlMap so another server\n   * could add itself to the url.\n   *\n   * @param {object} options\n   */\n  Server.prototype.close = function close (options) {\n    if ( options === void 0 ) options = {};\n\n    var code = options.code;\n    var reason = options.reason;\n    var wasClean = options.wasClean;\n    var listeners = networkBridge.websocketsLookup(this.url);\n\n    // Remove server before notifications to prevent immediate reconnects from\n    // socket onclose handlers\n    networkBridge.removeServer(this.url);\n\n    listeners.forEach(function (socket) {\n      socket.readyState = WebSocket$1.CLOSED;\n      socket.dispatchEvent(\n        createCloseEvent({\n          type: 'close',\n          target: socket.target,\n          code: code || CLOSE_CODES.CLOSE_NORMAL,\n          reason: reason || '',\n          wasClean: wasClean\n        })\n      );\n    });\n\n    this.dispatchEvent(createCloseEvent({ type: 'close' }), this);\n  };\n\n  /*\n   * Sends a generic message event to all mock clients.\n   */\n  Server.prototype.emit = function emit (event, data, options) {\n    var this$1 = this;\n    if ( options === void 0 ) options = {};\n\n    var websockets = options.websockets;\n\n    if (!websockets) {\n      websockets = networkBridge.websocketsLookup(this.url);\n    }\n\n    if (typeof options !== 'object' || arguments.length > 3) {\n      data = Array.prototype.slice.call(arguments, 1, arguments.length);\n      data = data.map(function (item) { return normalizeSendData(item); });\n    } else {\n      data = normalizeSendData(data);\n    }\n\n    websockets.forEach(function (socket) {\n      if (Array.isArray(data)) {\n        socket.dispatchEvent.apply(\n          socket, [ createMessageEvent({\n            type: event,\n            data: data,\n            origin: this$1.url,\n            target: socket.target\n          }) ].concat( data )\n        );\n      } else {\n        socket.dispatchEvent(\n          createMessageEvent({\n            type: event,\n            data: data,\n            origin: this$1.url,\n            target: socket.target\n          })\n        );\n      }\n    });\n  };\n\n  /*\n   * Returns an array of websockets which are listening to this server\n   * TOOD: this should return a set and not be a method\n   */\n  Server.prototype.clients = function clients () {\n    return networkBridge.websocketsLookup(this.url);\n  };\n\n  /*\n   * Prepares a method to submit an event to members of the room\n   *\n   * e.g. server.to('my-room').emit('hi!');\n   */\n  Server.prototype.to = function to (room, broadcaster, broadcastList) {\n    var this$1 = this;\n    if ( broadcastList === void 0 ) broadcastList = [];\n\n    var self = this;\n    var websockets = dedupe(broadcastList.concat(networkBridge.websocketsLookup(this.url, room, broadcaster)));\n\n    return {\n      to: function (chainedRoom, chainedBroadcaster) { return this$1.to.call(this$1, chainedRoom, chainedBroadcaster, websockets); },\n      emit: function emit(event, data) {\n        self.emit(event, data, { websockets: websockets });\n      }\n    };\n  };\n\n  /*\n   * Alias for Server.to\n   */\n  Server.prototype.in = function in$1 () {\n    var args = [], len = arguments.length;\n    while ( len-- ) args[ len ] = arguments[ len ];\n\n    return this.to.apply(null, args);\n  };\n\n  /*\n   * Simulate an event from the server to the clients. Useful for\n   * simulating errors.\n   */\n  Server.prototype.simulate = function simulate (event) {\n    var listeners = networkBridge.websocketsLookup(this.url);\n\n    if (event === 'error') {\n      listeners.forEach(function (socket) {\n        socket.readyState = WebSocket$1.CLOSED;\n        socket.dispatchEvent(createEvent({ type: 'error' }));\n      });\n    }\n  };\n\n  return Server;\n}(EventTarget));\n\n/*\n * Alternative constructor to support namespaces in socket.io\n *\n * http://socket.io/docs/rooms-and-namespaces/#custom-namespaces\n */\nServer$1.of = function of(url) {\n  return new Server$1(url);\n};\n\n/*\n * The socket-io class is designed to mimick the real API as closely as possible.\n *\n * http://socket.io/docs/\n */\nvar SocketIO$1 = (function (EventTarget$$1) {\n  function SocketIO(url, protocol) {\n    var this$1 = this;\n    if ( url === void 0 ) url = 'socket.io';\n    if ( protocol === void 0 ) protocol = '';\n\n    EventTarget$$1.call(this);\n\n    this.binaryType = 'blob';\n    var urlRecord = new urlParse(url);\n\n    if (!urlRecord.pathname) {\n      urlRecord.pathname = '/';\n    }\n\n    this.url = urlRecord.toString();\n    this.readyState = SocketIO.CONNECTING;\n    this.protocol = '';\n    this.target = this;\n\n    if (typeof protocol === 'string' || (typeof protocol === 'object' && protocol !== null)) {\n      this.protocol = protocol;\n    } else if (Array.isArray(protocol) && protocol.length > 0) {\n      this.protocol = protocol[0];\n    }\n\n    var server = networkBridge.attachWebSocket(this, this.url);\n\n    /*\n     * Delay triggering the connection events so they can be defined in time.\n     */\n    delay(function delayCallback() {\n      if (server) {\n        this.readyState = SocketIO.OPEN;\n        server.dispatchEvent(createEvent({ type: 'connection' }), server, this);\n        server.dispatchEvent(createEvent({ type: 'connect' }), server, this); // alias\n        this.dispatchEvent(createEvent({ type: 'connect', target: this }));\n      } else {\n        this.readyState = SocketIO.CLOSED;\n        this.dispatchEvent(createEvent({ type: 'error', target: this }));\n        this.dispatchEvent(\n          createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          })\n        );\n\n        log('error', (\"Socket.io connection to '\" + (this.url) + \"' failed\"));\n      }\n    }, this);\n\n    /**\n      Add an aliased event listener for close / disconnect\n     */\n    this.addEventListener('close', function (event) {\n      this$1.dispatchEvent(\n        createCloseEvent({\n          type: 'disconnect',\n          target: event.target,\n          code: event.code\n        })\n      );\n    });\n  }\n\n  if ( EventTarget$$1 ) SocketIO.__proto__ = EventTarget$$1;\n  SocketIO.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  SocketIO.prototype.constructor = SocketIO;\n\n  var prototypeAccessors = { broadcast: {} };\n\n  /*\n   * Closes the SocketIO connection or connection attempt, if any.\n   * If the connection is already CLOSED, this method does nothing.\n   */\n  SocketIO.prototype.close = function close () {\n    if (this.readyState !== SocketIO.OPEN) {\n      return undefined;\n    }\n\n    var server = networkBridge.serverLookup(this.url);\n    networkBridge.removeWebSocket(this, this.url);\n\n    this.readyState = SocketIO.CLOSED;\n    this.dispatchEvent(\n      createCloseEvent({\n        type: 'close',\n        target: this,\n        code: CLOSE_CODES.CLOSE_NORMAL\n      })\n    );\n\n    if (server) {\n      server.dispatchEvent(\n        createCloseEvent({\n          type: 'disconnect',\n          target: this,\n          code: CLOSE_CODES.CLOSE_NORMAL\n        }),\n        server\n      );\n    }\n\n    return this;\n  };\n\n  /*\n   * Alias for Socket#close\n   *\n   * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L383\n   */\n  SocketIO.prototype.disconnect = function disconnect () {\n    return this.close();\n  };\n\n  /*\n   * Submits an event to the server with a payload\n   */\n  SocketIO.prototype.emit = function emit (event) {\n    var data = [], len = arguments.length - 1;\n    while ( len-- > 0 ) data[ len ] = arguments[ len + 1 ];\n\n    if (this.readyState !== SocketIO.OPEN) {\n      throw new Error('SocketIO is already in CLOSING or CLOSED state');\n    }\n\n    var messageEvent = createMessageEvent({\n      type: event,\n      origin: this.url,\n      data: data\n    });\n\n    var server = networkBridge.serverLookup(this.url);\n\n    if (server) {\n      server.dispatchEvent.apply(server, [ messageEvent ].concat( data ));\n    }\n\n    return this;\n  };\n\n  /*\n   * Submits a 'message' event to the server.\n   *\n   * Should behave exactly like WebSocket#send\n   *\n   * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L113\n   */\n  SocketIO.prototype.send = function send (data) {\n    this.emit('message', data);\n    return this;\n  };\n\n  /*\n   * For broadcasting events to other connected sockets.\n   *\n   * e.g. socket.broadcast.emit('hi!');\n   * e.g. socket.broadcast.to('my-room').emit('hi!');\n   */\n  prototypeAccessors.broadcast.get = function () {\n    if (this.readyState !== SocketIO.OPEN) {\n      throw new Error('SocketIO is already in CLOSING or CLOSED state');\n    }\n\n    var self = this;\n    var server = networkBridge.serverLookup(this.url);\n    if (!server) {\n      throw new Error((\"SocketIO can not find a server at the specified URL (\" + (this.url) + \")\"));\n    }\n\n    return {\n      emit: function emit(event, data) {\n        server.emit(event, data, { websockets: networkBridge.websocketsLookup(self.url, null, self) });\n        return self;\n      },\n      to: function to(room) {\n        return server.to(room, self);\n      },\n      in: function in$1(room) {\n        return server.in(room, self);\n      }\n    };\n  };\n\n  /*\n   * For registering events to be received from the server\n   */\n  SocketIO.prototype.on = function on (type, callback) {\n    this.addEventListener(type, callback);\n    return this;\n  };\n\n  /*\n   * Remove event listener\n   *\n   * https://github.com/component/emitter#emitteroffevent-fn\n   */\n  SocketIO.prototype.off = function off (type, callback) {\n    this.removeEventListener(type, callback);\n  };\n\n  /*\n   * Check if listeners have already been added for an event\n   *\n   * https://github.com/component/emitter#emitterhaslistenersevent\n   */\n  SocketIO.prototype.hasListeners = function hasListeners (type) {\n    var listeners = this.listeners[type];\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n    return !!listeners.length;\n  };\n\n  /*\n   * Join a room on a server\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n   */\n  SocketIO.prototype.join = function join (room) {\n    networkBridge.addMembershipToRoom(this, room);\n  };\n\n  /*\n   * Get the websocket to leave the room\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n   */\n  SocketIO.prototype.leave = function leave (room) {\n    networkBridge.removeMembershipFromRoom(this, room);\n  };\n\n  SocketIO.prototype.to = function to (room) {\n    return this.broadcast.to(room);\n  };\n\n  SocketIO.prototype.in = function in$1 () {\n    return this.to.apply(null, arguments);\n  };\n\n  /*\n   * Invokes all listener functions that are listening to the given event.type property. Each\n   * listener will be passed the event as the first argument.\n   *\n   * @param {object} event - event object which will be passed to all listeners of the event.type property\n   */\n  SocketIO.prototype.dispatchEvent = function dispatchEvent (event) {\n    var this$1 = this;\n    var customArguments = [], len = arguments.length - 1;\n    while ( len-- > 0 ) customArguments[ len ] = arguments[ len + 1 ];\n\n    var eventName = event.type;\n    var listeners = this.listeners[eventName];\n\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n\n    listeners.forEach(function (listener) {\n      if (customArguments.length > 0) {\n        listener.apply(this$1, customArguments);\n      } else {\n        // Regular WebSockets expect a MessageEvent but Socketio.io just wants raw data\n        //  payload instanceof MessageEvent works, but you can't isntance of NodeEvent\n        //  for now we detect if the output has data defined on it\n        listener.call(this$1, event.data ? event.data : event);\n      }\n    });\n  };\n\n  Object.defineProperties( SocketIO.prototype, prototypeAccessors );\n\n  return SocketIO;\n}(EventTarget));\n\nSocketIO$1.CONNECTING = 0;\nSocketIO$1.OPEN = 1;\nSocketIO$1.CLOSING = 2;\nSocketIO$1.CLOSED = 3;\n\n/*\n * Static constructor methods for the IO Socket\n */\nvar IO = function ioConstructor(url, protocol) {\n  return new SocketIO$1(url, protocol);\n};\n\n/*\n * Alias the raw IO() constructor\n */\nIO.connect = function ioConnect(url, protocol) {\n  /* eslint-disable new-cap */\n  return IO(url, protocol);\n  /* eslint-enable new-cap */\n};\n\nvar Server = Server$1;\nvar WebSocket = WebSocket$1;\nvar SocketIO = IO;\n\nexports.Server = Server;\nexports.WebSocket = WebSocket;\nexports.SocketIO = SocketIO;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}